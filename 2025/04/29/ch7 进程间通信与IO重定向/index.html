<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="ch7 ËøõÁ®ãÈó¥ÈÄö‰ø°‰∏éIOÈáçÂÆöÂêë" />
    <meta name="hexo-theme-A4" content="v1.9.6" />
    <link rel="alternate icon" type="image/webp" href="/img/ryo.png">
    <title>SMS Derfflinger</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--Ê≥®ÊÑèÔºöÈ¶ñÈ°µÊó¢‰∏çÊòØpost‰πü‰∏çÊòØpage-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--ËøîÂõûÈ°∂ÈÉ®css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ÁõÆÂΩï-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>
    
    

    
    



    

    
    

    
    <style>
        :root {
            --waline-theme-color: #323e74; 
            --waline-color: #323e74; 
            --waline-border-color: #323e74; 
            --waline-white: #323e74; 
            --waline-bgcolor-light: #f2fafc;  
        }
        body {
            color: #323e74;
            background: #eaeae8;
        }
        .post-md code {
            background: #e7f7f3;
            color: #7f688d; 
        }
        .post-md pre, .post-md .highlight {
            background: #e7f7f3;
            color: #7f688d; 
        }
        pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata {
            color: #323e74;
        }
        pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant {
            color: #323e74;
        }
        .year-font-color {
            color: #323e74 !important;
        }
        .wl-card span.wl-nick {
            color: #323e74; 
        }
        .wl-card .wl-badge {
            border: 1px solid #323e74;
            color: #323e74; 
        }
        .wl-btn {
            border: 1px solid #323e74; 
            color:  #323e74;  
        }
        .wl-btn.primary {
            color: #f2fafc; 
        }
        .wl-header label {
            color: #323e74;
        }
        a {
            color: #7f688d;
        }

        .post-md a {
            color: #7f688d;
        }

        .nav li a {
            color: #7f688d;
        }

        .archive-main a:link {
            color: #7f688d;
        }
        .archive-main a:visited {
            color: #767c7c; 
        }

        .archive li span {
            color: #323e74;
        }

        .post-main-title {
            color: #323e74;
        }

        .post-md h1,
        .post-md h2,
        .post-md h3,
        .post-md h4,
        .post-md h5,
        .post-md h6 {
            color: #323e74;
        }

        [data-waline] p {
            color: #323e74;
        }
        [data-waline] a {
            color: #323e74;
        } 
        .wl-sort li.active {
            color: #323e74;
        }

        .wl-card .wl-meta>span {
            background: #f2fafc;
        }

        .paper {
            background: #eaeae8;
        }

        .index-main {
            background: #f2fafc;
        }

        .paper-main {
            background: #f2fafc;
        }

        .wl-panel {
            background: #f2fafc;
        }

        .archive li:nth-child(odd) {
            background: #f2fafc;
            ;
        }

        .archive li:nth-child(even) {
            background: #f2fafc;
        }

        .post-md table tr:nth-child(odd) td {
            background: #f2fafc;
        }

        .post-md table tr:nth-child(even) td {
            background: #f2fafc;
        }

    
        .progress-wrap::after {
            color: #323e74; /* ÁÆ≠Â§¥ÁöÑÈ¢úËâ≤ */
        }
        .progress-wrap svg.progress-circle path {
	        stroke: #323e74; /* ËæπÊ°ÜÁöÑÈ¢úËâ≤ */
        }
        .progress-wrap::before {
	        background-image: linear-gradient(298deg, #7f688d, #7f688d); /* Èº†Ê†áÊªëËøáÁöÑÁÆ≠Â§¥È¢úËâ≤ */
         }

        .return-to-last-progress-wrap::after {
            color: #323e74; /* ÁÆ≠Â§¥ÁöÑÈ¢úËâ≤ */
        }
        .return-to-last-progress-wrap svg.progress-circle path {
	        stroke: #323e74; /* ËæπÊ°ÜÁöÑÈ¢úËâ≤ */
        }
        .return-to-last-progress-wrap::before {
	        background-image: linear-gradient(298deg, #7f688d, #7f688d); /* Èº†Ê†áÊªëËøáÁöÑÁÆ≠Â§¥È¢úËâ≤ */
         }

         .left-toc-container::-webkit-scrollbar-thumb {
            background-color: #323e74; /* ËÆæÁΩÆÊªöÂä®Êù°ÊãñÂä®ÂùóÁöÑÈ¢úËâ≤ */
        }

        .bs-docs-sidebar .nav>.active>a,
        .bs-docs-sidebar .nav>li>a:hover,
        .bs-docs-sidebar .nav>li>a:focus {
            color: #7f688d;
            border-left-color: #7f688d;
        }
        .bs-docs-sidebar .nav>li>a {
            color:  #323e74;
        }
    </style>

    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #eaeae8  ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'üåì', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/ryo.png" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">SMS Derfflinger</a> 
            <span class="description">Just for fun.</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">È¶ñÈ°µ</a></li>
            
        
            
                <li><a href="/list/">ÊñáÁ´†</a></li>
            
        
            
                <li><a href="/tags/">Ê†áÁ≠æ</a></li>
            
        
            
                <li><a href="/categories/">ÂàÜÁ±ª</a></li>
            
        
            
                <li><a href="/about/">ÂÖ≥‰∫é</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--ËØ¥ÊòéÊòØÊñáÁ´†postÈ°µÈù¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    ch7 ËøõÁ®ãÈó¥ÈÄö‰ø°‰∏éIOÈáçÂÆöÂêë
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>ÊúÄËøëÊõ¥Êñ∞Ôºö2025-04-29</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>Â≠óÊï∞ÊÄªËÆ°Ôºö1.2k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>ÈòÖËØª‰º∞Êó∂Ôºö4ÂàÜÈíü</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        ÈòÖËØªÈáèÔºö<span id="busuanzi_value_page_pv"></span>Ê¨°
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
        
        <div class=".article-gallery"><h1 id="ch7-ËøõÁ®ãÈó¥ÈÄö‰ø°‰∏éIOÈáçÂÆöÂêë"><a href="#ch7-ËøõÁ®ãÈó¥ÈÄö‰ø°‰∏éIOÈáçÂÆöÂêë" class="headerlink" title="ch7 ËøõÁ®ãÈó¥ÈÄö‰ø°‰∏éIOÈáçÂÆöÂêë"></a>ch7 ËøõÁ®ãÈó¥ÈÄö‰ø°‰∏éIOÈáçÂÆöÂêë</h1><p>Êú¨ÊñáÊòØÂèÇÂä†<a target="_blank" rel="noopener" href="https://opencamp.cn/os2edu/camp/2025spring">2025Êò•Â§èÂ≠£ÂºÄÊ∫êÊìç‰ΩúÁ≥ªÁªüËÆ≠ÁªÉËê•</a>Êó∂ÂØπÁ¨¨‰∫åÈò∂ÊÆµÊñáÊ°£Á¨¨7Á´†ÂÅöÁöÑÁ¨îËÆ∞„ÄÇ</p>
<p>ÊñáÊ°£Ôºö<a target="_blank" rel="noopener" href="https://learningos.cn/rCore-Camp-Guide-2025S">https://learningos.cn/rCore-Camp-Guide-2025S</a></p>
<p>ÂÆåÊï¥ÁâàÊñáÊ°£Ôºö<a target="_blank" rel="noopener" href="https://rcore-os.cn/rCore-Tutorial-Book-v3">https://rcore-os.cn/rCore-Tutorial-Book-v3</a></p>
<h2 id="ÂºïË®Ä"><a href="#ÂºïË®Ä" class="headerlink" title="ÂºïË®Ä"></a>ÂºïË®Ä</h2><p>Êú¨Á´†Â∞ÜÂü∫‰∫éÊñá‰ª∂ÊèèËø∞Á¨¶ÂÆûÁé∞Áà∂Â≠êËøõÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°Êú∫Âà∂‚Äî‚ÄîÁÆ°ÈÅì„ÄÇÊîØÊåÅËøõÁ®ãÈó¥ÁöÑI/OÈáçÂÆöÂêëÂäüËÉΩÔºåÂç≥ËÆ©‰∏Ä‰∏™ËøõÁ®ãÁöÑËæìÂá∫Êàê‰∏∫Âè¶Â§ñ‰∏Ä‰∏™ËøõÁ®ãÁöÑËæìÂÖ•„ÄÇÊääÊ†áÂáÜI/OÂíåÁÆ°ÈÅìËøô‰∏âÁßçËæìÂÖ•ËæìÂá∫ÈÉΩÁªü‰∏ÄÂú® <strong>Êñá‰ª∂</strong> Ëøô‰∏™ÊäΩË±°‰πã‰∏≠„ÄÇ</p>
<h2 id="ÁÆ°ÈÅì"><a href="#ÁÆ°ÈÅì" class="headerlink" title="ÁÆ°ÈÅì"></a>ÁÆ°ÈÅì</h2><p>Âú®Á±ªUNIXÊìç‰ΩúÁ≥ªÁªü‰∏≠Ôºå‰∏ÄÂàáÁöÜÊñá‰ª∂ÔºåÊìç‰ΩúÁ≥ªÁªüÂèØ‰ª•ÈÄöËøáÊñá‰ª∂ÊèèËø∞Á¨¶Âú®ÂΩìÂâçËøõÁ®ãÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Ë°®‰∏≠ÊâæÂà∞Êüê‰∏™Êñá‰ª∂ÔºåÊó†ÈúÄÂÖ≥ÂøÉÊñá‰ª∂ÂÖ∑‰ΩìÁöÑÁ±ªÂûãÔºåÂè™Ë¶ÅÁü•ÈÅìÂÆÉ‰∏ÄÂÆöÂÆûÁé∞‰∫Ü¬†<code>File</code>¬†Trait ÁöÑ¬†<code>read/write</code>¬†ÊñπÊ≥ïÂç≥ÂèØ„ÄÇÈÄöËøáÂü∫‰∫éÊñá‰ª∂Êé•Âè£ÁöÑÊ†áÂáÜËæìÂÖ•ÂíåËæìÂá∫Ôºå‰∏Ä‰∏™ËøõÁ®ãÂèØ‰ª•Ê†πÊçÆ‰∏çÂêåÁöÑËæìÂÖ•‰∫ßÁîüÂØπÂ∫îÁöÑËæìÂá∫„ÄÇ</p>
<p>ÁÆ°ÈÅìÊòØ‰∏ÄÁßçËøõÁ®ãÈó¥ÈÄö‰ø°Êú∫Âà∂ÔºåÈÄöËøáÁõ¥Êé•ÁºñÁ®ãÊàñÂú®shellÁ®ãÂ∫èÁöÑÂ∏ÆÂä©‰∏ãËΩªÊùæÂú∞Êää‰∏çÂêåËøõÁ®ãÁöÑËæìÂÖ•ÂíåËæìÂá∫ÂØπÊé•Ëµ∑Êù•„ÄÇÂèØ‰ª•Â∞ÜÁÆ°ÈÅìÁúãÊàê‰∏Ä‰∏™Êúâ‰∏ÄÂÆöÁºìÂÜ≤Âå∫Â§ßÂ∞èÁöÑÂ≠óËäÇÈòüÂàóÔºåËØªÂíåÂÜô‰∏§Á´ØÈúÄË¶ÅÈÄöËøá‰∏çÂêåÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Êù•ËÆøÈóÆ„ÄÇ</p>
<p>‰∏∫‰∫ÜÂÆûÁé∞ÁÆ°ÈÅìÔºåÊñ∞Â¢û‰∫Ü <code>sys_pipe</code> Âíå <code>sys_close</code> Á≥ªÁªüË∞ÉÁî®Ôºå<code>sys_pipe</code> ‰∏∫ÂΩìÂâçËøõÁ®ãÊâìÂºÄ‰∏Ä‰∏™ÁÆ°ÈÅìÔºå<code>sys_close</code> Â∞ÜËøõÁ®ãÊéßÂà∂Âùó‰∏≠ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Ë°®ÂØπÂ∫îÁöÑ‰∏ÄÈ°πÊîπ‰∏∫¬†<code>None</code>¬†‰ª£Ë°®ÂÆÉÂ∑≤ÁªèÁ©∫Èó≤ÔºõÂΩì‰∏Ä‰∏™ÁÆ°ÈÅìÁöÑÊâÄÊúâËØªÁ´ØÊñá‰ª∂/ÂÜôÁ´ØÊñá‰ª∂ÈÉΩË¢´ÂÖ≥Èó≠‰πãÂêéÔºåÁÆ°ÈÅìÂç†Áî®ÁöÑËµÑÊ∫ê‰ºöË¢´ÂõûÊî∂„ÄÇ</p>
<p>ÁÆ°ÈÅìÁöÑ‰∏ÄÁ´ØË¢´ÊäΩË±°‰∏∫¬†<code>Pipe</code>Ôºö</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/fs/pipe.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Pipe</span> {</span><br><span class="line">    readable: <span class="type">bool</span>,</span><br><span class="line">    writable: <span class="type">bool</span>,</span><br><span class="line">    buffer: Arc&lt;Mutex&lt;PipeRingBuffer&gt;&gt;,</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>PipeRingBuffer Âç≥ÁÆ°ÈÅìÁöÑÊú¨‰ΩìÔºåÊòØ‰∏Ä‰∏™Âæ™ÁéØÂ≠óËäÇÈòüÂàóÔºö</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">PipeRingBuffer</span> {</span><br><span class="line">    arr: [<span class="type">u8</span>; RING_BUFFER_SIZE],</span><br><span class="line">    head: <span class="type">usize</span>,</span><br><span class="line">    tail: <span class="type">usize</span>,</span><br><span class="line">    status: RingBufferStatus,</span><br><span class="line">    write_end: <span class="type">Option</span>&lt;Weak&lt;Pipe&gt;&gt;,</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>ÂØπÁÆ°ÈÅìÁöÑËØªÂÜôÈÄöËøáÂØπËøô‰∏™Âæ™ÁéØÈòüÂàóÊìç‰ΩúÂç≥ÂèØÂÆûÁé∞„ÄÇ</p>
<h2 id="ÂëΩ‰ª§Ë°åÂèÇÊï∞‰∏éÊ†áÂáÜ-I-O-ÈáçÂÆöÂêë"><a href="#ÂëΩ‰ª§Ë°åÂèÇÊï∞‰∏éÊ†áÂáÜ-I-O-ÈáçÂÆöÂêë" class="headerlink" title="ÂëΩ‰ª§Ë°åÂèÇÊï∞‰∏éÊ†áÂáÜ I/O ÈáçÂÆöÂêë"></a>ÂëΩ‰ª§Ë°åÂèÇÊï∞‰∏éÊ†áÂáÜ I/O ÈáçÂÆöÂêë</h2><p>‰ΩøÁî® C ËØ≠Ë®ÄÂºÄÂèë Linux Â∫îÁî®Êó∂ÔºåÂèØ‰ª•‰ΩøÁî®Ê†áÂáÜÂ∫ìÊèê‰æõÁöÑ¬†<code>argc/argv</code>¬†Êù•Ëé∑ÂèñÂëΩ‰ª§Ë°åÂèÇÊï∞Ôºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> {</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>‰∏∫‰∫ÜÊîØÊåÅËøô‰∏™ÂäüËÉΩÔºåÈúÄË¶Å‰øÆÊîπ¬†<code>sys_exec</code> Á≥ªÁªüË∞ÉÁî®ÔºåÂõ†‰∏∫ÂëΩ‰ª§Ë°åÂèÇÊï∞ÊòØ shell ÈÄöËøá exec ËøêË°åÂ≠êËøõÁ®ãÂÆûÁé∞ÁöÑ„ÄÇ</p>
<p>Âú®shellÁ®ãÂ∫è¬†<code>user_shell</code>¬†‰∏≠Ôºå‰∏ÄÊó¶Êé•Êî∂Âà∞‰∏Ä‰∏™ÂõûËΩ¶ÔºåÂ∞±‰ºöÂºÄÂßãÊâßË°å„ÄÇ‰ΩÜÊòØÁé∞Âú®¬†<code>line</code>¬†ËøòÂèØËÉΩÂåÖÂê´‰∏Ä‰∫õÂëΩ‰ª§Ë°åÂèÇÊï∞ÔºåÂõ†Ê≠§ÈúÄË¶ÅÂ∞Ü¬†<code>line</code>¬†Áî®Á©∫Ê†ºËøõË°åÂàÜÂâ≤ÔºåÁÑ∂ÂêéÂ∞ÜÂ§ÑÁêÜÂêéÁöÑÂèÇÊï∞ÂéãÂÖ•Áî®Êà∑Ê†àÔºå‰ª•‰∏ã‰∏∫Êñ∞Â¢ûÁöÑÈÉ®ÂàÜÔºö</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/task/task.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TaskControlBlock</span> {</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">exec</span>(&amp;<span class="keyword">self</span>, elf_data: &amp;[<span class="type">u8</span>], args: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt;) {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// push arguments on user stack</span></span><br><span class="line">    user_sp -= (args.<span class="title function_ invoke__">len</span>() + <span class="number">1</span>) * core::mem::size_of::&lt;<span class="type">usize</span>&gt;();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">argv_base</span> = user_sp;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">argv</span>: <span class="type">Vec</span>&lt;_&gt; = (<span class="number">0</span>..=args.<span class="title function_ invoke__">len</span>())</span><br><span class="line">	    .<span class="title function_ invoke__">map</span>(|arg| {</span><br><span class="line">		    <span class="title function_ invoke__">translated_refmut</span>(</span><br><span class="line">			    memory_set.<span class="title function_ invoke__">token</span>(),</span><br><span class="line">			    (argv_base + arg * core::mem::size_of::&lt;<span class="type">usize</span>&gt;()) <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">usize</span></span><br><span class="line">			    )</span><br><span class="line">			})</span><br><span class="line">			.<span class="title function_ invoke__">collect</span>();</span><br><span class="line">		*argv[args.<span class="title function_ invoke__">len</span>()] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..args.<span class="title function_ invoke__">len</span>() {</span><br><span class="line">			user_sp -= args[i].<span class="title function_ invoke__">len</span>() + <span class="number">1</span>;</span><br><span class="line">			*argv[i] = user_sp;</span><br><span class="line">			<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span> = user_sp;</span><br><span class="line">			<span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> args[i].<span class="title function_ invoke__">as_bytes</span>() {</span><br><span class="line">				*<span class="title function_ invoke__">translated_refmut</span>(memory_set.<span class="title function_ invoke__">token</span>(), p <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">u8</span>) = *c;</span><br><span class="line">				p += <span class="number">1</span>;</span><br><span class="line">			}</span><br><span class="line">			*<span class="title function_ invoke__">translated_refmut</span>(memory_set.<span class="title function_ invoke__">token</span>(), p <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">u8</span>) = <span class="number">0</span>;</span><br><span class="line">		}</span><br><span class="line">		<span class="comment">// make the user_sp aligned to 8B</span></span><br><span class="line">		user_sp -= user_sp % core::mem::size_of::&lt;<span class="type">usize</span>&gt;();</span><br><span class="line">		<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">trap_cx</span> = TrapContext::<span class="title function_ invoke__">app_init_context</span>(</span><br><span class="line">			entry_point,</span><br><span class="line">			user_sp,</span><br><span class="line">			KERNEL_SPACE.<span class="title function_ invoke__">exclusive_access</span>().<span class="title function_ invoke__">token</span>(),</span><br><span class="line">			<span class="keyword">self</span>.kernel_stack.<span class="title function_ invoke__">get_top</span>(),</span><br><span class="line">			trap_handler <span class="keyword">as</span> <span class="type">usize</span>,</span><br><span class="line">		);</span><br><span class="line">		trap_cx.x[<span class="number">10</span>] = args.<span class="title function_ invoke__">len</span>();</span><br><span class="line">		trap_cx.x[<span class="number">11</span>] = argv_base;</span><br><span class="line">		<span class="comment">// **** release current PCB</span></span><br><span class="line">	}</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ul>
<li>Âú®Áî®Êà∑Ê†à‰∏äÂàÜÈÖç‰∫Ü‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÊåáÈíàÊï∞ÁªÑÔºåÊï∞ÁªÑ‰∏≠ÁöÑÊØè‰∏™ÂÖÉÁ¥†ÈÉΩÊåáÂêë‰∏Ä‰∏™Áî®Êà∑Ê†àÊõ¥‰ΩéÂ§ÑÁöÑÂëΩ‰ª§Ë°åÂèÇÊï∞Â≠óÁ¨¶‰∏≤ÁöÑËµ∑ÂßãÂú∞ÂùÄ„ÄÇ</li>
<li>ÈÄê‰∏™Â∞Ü‰º†ÂÖ•ÁöÑ¬†<code>args</code>¬†‰∏≠ÁöÑÂ≠óÁ¨¶‰∏≤ÂéãÂÖ•Âà∞Áî®Êà∑Ê†à‰∏≠ÔºåÂú®Áî®Êà∑Ê†à‰∏äÈ¢ÑÁïôÁ©∫Èó¥‰πãÂêéÈÄêÂ≠óËäÇËøõË°åÂ§çÂà∂„ÄÇ</li>
<li>Â∞Ü¬†<code>user_sp</code>¬†‰ª• 8 Â≠óËäÇÂØπÈΩê„ÄÇ</li>
<li>‰øÆÊîπ Trap ‰∏ä‰∏ãÊñá‰∏≠ÁöÑ¬†<code>a0/a1</code>¬†ÂØÑÂ≠òÂô®ÔºåËÆ©¬†<code>a0</code>¬†Ë°®Á§∫ÂëΩ‰ª§Ë°åÂèÇÊï∞ÁöÑ‰∏™Êï∞Ôºå<code>a1</code> Ë°®Á§∫ÂèÇÊï∞ÁöÑËµ∑ÂßãÂú∞ÂùÄ„ÄÇ</li>
</ul>
<p>Â∫îÁî®Á¨¨‰∏ÄÊ¨°ËøõÂÖ•Áî®Êà∑ÊÄÅÁöÑÊó∂ÂÄôÔºåÊîæÂú® Trap ‰∏ä‰∏ãÊñá a0/a1 ‰∏§‰∏™ÂØÑÂ≠òÂô®‰∏≠ÁöÑÂÜÖÂÆπÂèØ‰ª•Ë¢´Áî®Êà∑Â∫ì‰∏≠ÁöÑÂÖ•Âè£ÂáΩÊï∞ _start ‰ª•ÂèÇÊï∞ÁöÑÂΩ¢ÂºèÊé•Âèó„ÄÇ</p>
<p>I/O ÈáçÂÆöÂêëÂæàÂ•ΩËß£ÂÜ≥Ôºå‰øÆÊîπÂØπÂ∫îÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Âç≥ÂèØÔºåÊñ∞Â¢û‰∫Ü‰∏Ä‰∏™Á≥ªÁªüË∞ÉÁî® <code>sys_dup</code>ÔºåÁî®‰∫éÂ∞ÜËøõÁ®ã‰∏≠‰∏Ä‰∏™Â∑≤ÁªèÊâìÂºÄÁöÑÊñá‰ª∂Â§çÂà∂‰∏Ä‰ªΩÔºåÂàÜÈÖçÂà∞‰∏Ä‰∏™Êñ∞ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶‰∏≠„ÄÇÂú®shellÁ®ãÂ∫è¬†<code>user_shell</code>¬†ÂàÜÂâ≤ÂëΩ‰ª§Ë°åÂèÇÊï∞ÁöÑÊó∂ÂÄôÔºåÊ£ÄÊü•ÊòØÂê¶Â≠òÂú®¬†<code>&lt;</code>¬†Êàñ¬†<code>&gt;</code>ÔºåÂ¶ÇÊûúÂ≠òÂú®ÁöÑËØùËÆ∞ÂΩïÂåπÈÖçÂà∞ÁöÑËæìÂÖ•Êñá‰ª∂ÂêçÊàñËæìÂá∫Êñá‰ª∂ÂêçÂà∞Â≠óÁ¨¶‰∏≤¬†<code>input</code>¬†Êàñ¬†<code>output</code>¬†‰∏≠ÔºåÁÑ∂ÂêéÂú® folk ‰πãÂêéÂÜçÊõøÊç¢ÂØπÂ∫îÁöÑÊñá‰ª∂„ÄÇ</p>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2025-04-29</span>
            
                <span>ËØ•ÁØáÊñáÁ´†Ë¢´ Derfflinger</span>
            
            
                <span>Êâì‰∏äÊ†áÁ≠æ:
                    
                    
                        <a href='/tags/OS/'>
                            OS
                        </a>
                    
                        <a href='/tags/System/'>
                            System
                        </a>
                    
                        <a href='/tags/Rust/'>
                            Rust
                        </a>
                    
                </span>
             
             
                <span>ÂΩí‰∏∫ÂàÜÁ±ª:
                    
                    
                        <a href='/categories/rCore/'>
                            rCore
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>‰∏ä‰∏ÄÁØáÔºö<a href='/2025/04/29/ch8%20%E5%B9%B6%E5%8F%91/'>ch8 Âπ∂Âèë</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">‰∏ã‰∏ÄÁØáÔºö<a href="/2025/04/22/ch6%20%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">ch6 Êñá‰ª∂Á≥ªÁªü</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
       
    
</div>



<!--ËøôÊòØÊåá‰∏ÄÊù°Á∫øÂæÄ‰∏ãÁöÑÂÜÖÂÆπ-->
<div class="footer-last">
    
            <span></span>
            
                <span class="footer-last-span-right"><i>Êú¨Á´ôÁî±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>È©±Âä®ÔΩú‰ΩøÁî®<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>‰∏ªÈ¢ò</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ÁõÆÂΩï-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--ÂõûÂà∞È°∂ÈÉ®ÊåâÈíÆ-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // ÂêØÁî®Êèí‰ª∂
            thumbnail: true,          // ÊòæÁ§∫Áº©Áï•Âõæ
            zoom: true,               // ÂêØÁî®Áº©ÊîæÂäü
            rotate: true,             // ÂêØÁî®ÊóãËΩ¨ÂäüËÉΩËÉΩ
            autoplay: true,        // ÂêØÁî®Ëá™Âä®Êí≠ÊîæÂäüËÉΩ
            fullScreen: true,      // ÂêØÁî®ÂÖ®Â±èÂäüËÉΩ
            pager: false, //È°µÁ†Å,
            zoomFromOrigin: true,   // ‰ªéÂéüÂßã‰ΩçÁΩÆÁº©Êîæ
            actualSize: true,       // ÂêØÁî®Êü•ÁúãÂÆûÈôÖÂ§ßÂ∞èÁöÑÂäüËÉΩ
            enableZoomAfter: 300,    // Âª∂ËøüÁº©ÊîæÔºåÁ°Æ‰øùÂõæÁâáÂä†ËΩΩÂÆåÊàêÂêéÂèØÁº©Êîæ
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ‰øÆÂ§çÈÄâÊã©Âô®
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- ÂõûÂà∞È°∂ÈÉ®ÁöÑÊåâÈíÆ-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- ËøîÂõûÁöÑÊåâÈíÆ-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>
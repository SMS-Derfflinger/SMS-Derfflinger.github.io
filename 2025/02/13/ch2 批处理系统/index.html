<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="ch2 ÊâπÂ§ÑÁêÜÁ≥ªÁªü" />
    <meta name="hexo-theme-A4" content="v1.9.6" />
    <link rel="alternate icon" type="image/webp" href="/img/ryo.png">
    <title>SMS Derfflinger</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--Ê≥®ÊÑèÔºöÈ¶ñÈ°µÊó¢‰∏çÊòØpost‰πü‰∏çÊòØpage-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--ËøîÂõûÈ°∂ÈÉ®css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ÁõÆÂΩï-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>
    
    

    
    



    

    
    

    
    <style>
        :root {
            --waline-theme-color: #323e74; 
            --waline-color: #323e74; 
            --waline-border-color: #323e74; 
            --waline-white: #323e74; 
            --waline-bgcolor-light: #f2fafc;  
        }
        body {
            color: #323e74;
            background: #eaeae8;
        }
        .post-md code {
            background: #e7f7f3;
            color: #7f688d; 
        }
        .post-md pre, .post-md .highlight {
            background: #e7f7f3;
            color: #7f688d; 
        }
        pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata {
            color: #323e74;
        }
        pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant {
            color: #323e74;
        }
        .year-font-color {
            color: #323e74 !important;
        }
        .wl-card span.wl-nick {
            color: #323e74; 
        }
        .wl-card .wl-badge {
            border: 1px solid #323e74;
            color: #323e74; 
        }
        .wl-btn {
            border: 1px solid #323e74; 
            color:  #323e74;  
        }
        .wl-btn.primary {
            color: #f2fafc; 
        }
        .wl-header label {
            color: #323e74;
        }
        a {
            color: #7f688d;
        }

        .post-md a {
            color: #7f688d;
        }

        .nav li a {
            color: #7f688d;
        }

        .archive-main a:link {
            color: #7f688d;
        }
        .archive-main a:visited {
            color: #767c7c; 
        }

        .archive li span {
            color: #323e74;
        }

        .post-main-title {
            color: #323e74;
        }

        .post-md h1,
        .post-md h2,
        .post-md h3,
        .post-md h4,
        .post-md h5,
        .post-md h6 {
            color: #323e74;
        }

        [data-waline] p {
            color: #323e74;
        }
        [data-waline] a {
            color: #323e74;
        } 
        .wl-sort li.active {
            color: #323e74;
        }

        .wl-card .wl-meta>span {
            background: #f2fafc;
        }

        .paper {
            background: #eaeae8;
        }

        .index-main {
            background: #f2fafc;
        }

        .paper-main {
            background: #f2fafc;
        }

        .wl-panel {
            background: #f2fafc;
        }

        .archive li:nth-child(odd) {
            background: #f2fafc;
            ;
        }

        .archive li:nth-child(even) {
            background: #f2fafc;
        }

        .post-md table tr:nth-child(odd) td {
            background: #f2fafc;
        }

        .post-md table tr:nth-child(even) td {
            background: #f2fafc;
        }

    
        .progress-wrap::after {
            color: #323e74; /* ÁÆ≠Â§¥ÁöÑÈ¢úËâ≤ */
        }
        .progress-wrap svg.progress-circle path {
	        stroke: #323e74; /* ËæπÊ°ÜÁöÑÈ¢úËâ≤ */
        }
        .progress-wrap::before {
	        background-image: linear-gradient(298deg, #7f688d, #7f688d); /* Èº†Ê†áÊªëËøáÁöÑÁÆ≠Â§¥È¢úËâ≤ */
         }

        .return-to-last-progress-wrap::after {
            color: #323e74; /* ÁÆ≠Â§¥ÁöÑÈ¢úËâ≤ */
        }
        .return-to-last-progress-wrap svg.progress-circle path {
	        stroke: #323e74; /* ËæπÊ°ÜÁöÑÈ¢úËâ≤ */
        }
        .return-to-last-progress-wrap::before {
	        background-image: linear-gradient(298deg, #7f688d, #7f688d); /* Èº†Ê†áÊªëËøáÁöÑÁÆ≠Â§¥È¢úËâ≤ */
         }

         .left-toc-container::-webkit-scrollbar-thumb {
            background-color: #323e74; /* ËÆæÁΩÆÊªöÂä®Êù°ÊãñÂä®ÂùóÁöÑÈ¢úËâ≤ */
        }

        .bs-docs-sidebar .nav>.active>a,
        .bs-docs-sidebar .nav>li>a:hover,
        .bs-docs-sidebar .nav>li>a:focus {
            color: #7f688d;
            border-left-color: #7f688d;
        }
        .bs-docs-sidebar .nav>li>a {
            color:  #323e74;
        }
    </style>

    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #eaeae8  ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'üåì', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/ryo.png" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">SMS Derfflinger</a> 
            <span class="description">Just for fun.</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">È¶ñÈ°µ</a></li>
            
        
            
                <li><a href="/list/">ÊñáÁ´†</a></li>
            
        
            
                <li><a href="/tags/">Ê†áÁ≠æ</a></li>
            
        
            
                <li><a href="/categories/">ÂàÜÁ±ª</a></li>
            
        
            
                <li><a href="/about/">ÂÖ≥‰∫é</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--ËØ¥ÊòéÊòØÊñáÁ´†postÈ°µÈù¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    ch2 ÊâπÂ§ÑÁêÜÁ≥ªÁªü
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>ÊúÄËøëÊõ¥Êñ∞Ôºö2025-04-12</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>Â≠óÊï∞ÊÄªËÆ°Ôºö6.1k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>ÈòÖËØª‰º∞Êó∂Ôºö24ÂàÜÈíü</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        ÈòÖËØªÈáèÔºö<span id="busuanzi_value_page_pv"></span>Ê¨°
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
        
        <div class=".article-gallery"><h1 id="ch2-ÊâπÂ§ÑÁêÜÁ≥ªÁªü"><a href="#ch2-ÊâπÂ§ÑÁêÜÁ≥ªÁªü" class="headerlink" title="ch2 ÊâπÂ§ÑÁêÜÁ≥ªÁªü"></a>ch2 ÊâπÂ§ÑÁêÜÁ≥ªÁªü</h1><p>Êú¨ÊñáÊòØÂèÇÂä†<a target="_blank" rel="noopener" href="https://opencamp.cn/os2edu/camp/2025spring">2025Êò•Â§èÂ≠£ÂºÄÊ∫êÊìç‰ΩúÁ≥ªÁªüËÆ≠ÁªÉËê•</a>Êó∂ÂØπÁ¨¨‰∫åÈò∂ÊÆµÊñáÊ°£Á¨¨2Á´†ÂÅöÁöÑÁ¨îËÆ∞„ÄÇ</p>
<p>ÊñáÊ°£Ôºö<a target="_blank" rel="noopener" href="https://learningos.cn/rCore-Camp-Guide-2025S">https://learningos.cn/rCore-Camp-Guide-2025S</a></p>
<p>ÂÆåÊï¥ÁâàÊñáÊ°£Ôºö<a target="_blank" rel="noopener" href="https://rcore-os.cn/rCore-Tutorial-Book-v3">https://rcore-os.cn/rCore-Tutorial-Book-v3</a></p>
<h2 id="ÂºïË®Ä"><a href="#ÂºïË®Ä" class="headerlink" title="ÂºïË®Ä"></a>ÂºïË®Ä</h2><p>Êú¨Á´†Âú®Ââç‰∏ÄÁ´†ÁöÑÂü∫Á°Ä‰∏äÔºåÂ∞ÜÂ§ö‰∏™Á®ãÂ∫èÊâìÂåÖÂà∞‰∏ÄËµ∑ËæìÂÖ•ËÆ°ÁÆóÊú∫ÔºåÊîØÊåÅÂ§ö‰∏™Á®ãÂ∫èÁöÑËá™Âä®Âä†ËΩΩÂíåËøêË°åÔºåÂØπÂèØÊîØÊåÅËøêË°å‰∏ÄÊâπÂ∫îÁî®Á®ãÂ∫èÁöÑÊâßË°åÁéØÂ¢ÉÊúâ‰∏Ä‰∏™ÂÖ®Èù¢ÂíåÊ∑±ÂÖ•ÁöÑÁêÜËß£„ÄÇ</p>
<p>Êú¨Á´†Áõ∏ÊØî‰∏ä‰∏ÄÁ´†ÁöÑlibOSÔºå‰∏çÂêåÁÇπ‰∏ªË¶ÅÊúâ‰∏§‰∏™Ôºö‰∏ÄÊòØÊìç‰ΩúÁ≥ªÁªüÂíåÁî®Êà∑Á®ãÂ∫èËøêË°åÂú®‰∏çÂêåÁöÑÁâπÊùÉÁ∫ß‰∏äÔºõ‰∫åÊòØËÉΩÂ§üËøûÁª≠Ëá™Âä®ËøêË°å‰∏çÂêåÁöÑÁ®ãÂ∫è„ÄÇ</p>
<p>‰∏ªË¶ÅÁöÑÂÆûÁé∞ÊµÅÁ®ã‰∏∫Ôºö</p>
<ol>
<li>ÁºñÂÜôÂ∫îÁî®Á®ãÂ∫èÔºåÂú®Áî®Êà∑ÊÄÅËøêË°åÔºåÈÄöËøáÁ≥ªÁªüË∞ÉÁî®Êù•‰∏éÊìç‰ΩúÁ≥ªÁªü‰∫§‰∫í„ÄÇ</li>
<li>‰∏∫Êìç‰ΩúÁ≥ªÁªüÂÆûÁé∞Á≥ªÁªüË∞ÉÁî®„ÄÇ</li>
<li>Êìç‰ΩúÁ≥ªÁªüËøòÈúÄÁªô Binary Â∫îÁî®ÂàÜÈÖçÂ•ΩÂØπÂ∫îÊâßË°åÁéØÂ¢ÉÊâÄÈúÄ‰∏ÄÁ≥ªÂàóÁöÑËµÑÊ∫êÔºåÂåÖÊã¨Áî®Êà∑Ê†àÂíåÂÜÖÊ†∏Ê†àÁ≠â„ÄÇ</li>
<li>‰∏∫Êìç‰ΩúÁ≥ªÁªüÂÆûÁé∞Ëá™Âä®Âä†ËΩΩËøêË°åÁî®Êà∑Á®ãÂ∫è„ÄÇ</li>
</ol>
<h2 id="ÁâπÊùÉÁ∫ßÊú∫Âà∂"><a href="#ÁâπÊùÉÁ∫ßÊú∫Âà∂" class="headerlink" title="ÁâπÊùÉÁ∫ßÊú∫Âà∂"></a>ÁâπÊùÉÁ∫ßÊú∫Âà∂</h2><p>Â∫îÁî®Á®ãÂ∫èÁöÑÂÆâÂÖ®ÊÄß‰∏çËÉΩÂÆåÂÖ®‰ø°‰ªªÔºåÂèØËÉΩ‰ºöÁ†¥ÂùèÁ°¨‰ª∂ÁéØÂ¢ÉÔºåÂºïÂÖ•ÁâπÊùÉÁ∫ßÊú∫Âà∂ÔºåÂ∞ÜÂ∫îÁî®Á®ãÂ∫èÂíåÂèØ‰ø°ËµñÁöÑÊìç‰ΩúÁ≥ªÁªüËøêË°åÂú®‰∏çÂêåÁöÑÁâπÊùÉÁ∫ß‰∏ãÔºåÊØîËæÉÂÆâÂÖ®„ÄÇ</p>
<p>RISC-VÂÆö‰πâ‰∫ÜÂõõ‰∏™‰∏ªË¶ÅÁöÑÁâπÊùÉÁ∫ßÂà´ÔºåÂÆÉ‰ª¨ÂàÜÂà´‰∏∫Ôºö</p>
<ol>
<li><p><strong>Áî®Êà∑Ê®°ÂºèÔºàUser Mode, UÔºâ</strong>Ôºö</p>
<ul>
<li>ÊúÄÂü∫Êú¨ÁöÑÊâßË°åÊ®°ÂºèÔºåÂ∫îÁî®Á®ãÂ∫èÂíåÁî®Êà∑‰ª£Á†ÅÂú®ËØ•Ê®°Âºè‰∏ãËøêË°å„ÄÇ</li>
<li>Áî®Êà∑Ê®°ÂºèÁöÑÁ®ãÂ∫èÊó†Ê≥ïÁõ¥Êé•ËÆøÈóÆÁ°¨‰ª∂ËµÑÊ∫êÊàñÊâßË°åÁâπÊùÉÊìç‰ΩúÔºàÂ¶ÇËÆøÈóÆÊéßÂà∂ÂØÑÂ≠òÂô®„ÄÅ‰øÆÊîπÁ≥ªÁªüÁä∂ÊÄÅÁ≠âÔºâ„ÄÇ</li>
<li>Áî®Êà∑Á®ãÂ∫èÂè™ËÉΩÈÄöËøáÁ≥ªÁªüË∞ÉÁî®„ÄÅÈô∑Èò±Á≠âÊú∫Âà∂ËØ∑Ê±ÇÊìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÊâßË°åÁâπÊùÉÊìç‰Ωú„ÄÇ</li>
</ul>
</li>
<li><p><strong>Ë∂ÖÁ∫ßÁî®Êà∑Ê®°ÂºèÔºàSupervisor Mode, SÔºâ</strong>Ôºö</p>
<ul>
<li>Êìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÈÄöÂ∏∏ËøêË°åÂú®Ë∂ÖÁ∫ßÁî®Êà∑Ê®°Âºè‰∏ã„ÄÇ</li>
<li>Âú®ËØ•Ê®°Âºè‰∏ãÔºåÊìç‰ΩúÁ≥ªÁªüÂèØ‰ª•ÁÆ°ÁêÜÁ°¨‰ª∂„ÄÅËÆøÈóÆÊâÄÊúâÂÜÖÂ≠ò„ÄÅËÆæÁΩÆ‰∏≠Êñ≠„ÄÅ‰ª•ÂèäÊâßË°åÁâπÊùÉÊåá‰ª§Á≠â„ÄÇ</li>
<li>Ë∂ÖÁ∫ßÁî®Êà∑Ê®°ÂºèÊòØÊìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÁöÑÂü∫Á°ÄÁâπÊùÉÁ∫ßÔºåÂèØ‰ª•Áõ¥Êé•ËÆøÈóÆÂÜÖÂ≠òÂíåÂ§ñËÆæËµÑÊ∫ê„ÄÇ</li>
</ul>
</li>
<li><p><strong>ËôöÊãüÊú∫Ê®°ÂºèÔºàÂ¶ÇÊûúÂêØÁî®ËôöÊãüÂåñÔºâ</strong>Ôºö</p>
<ul>
<li>ËôΩÁÑ∂RISC-VÁöÑÊ†áÂáÜISAÊ≤°ÊúâÊòéÁ°ÆÊèêÂà∞‚ÄúËôöÊãüÊú∫Ê®°Âºè‚ÄùÔºå‰ΩÜÊòØÂÆÉÊîØÊåÅËôöÊãüÂåñÊâ©Â±ï„ÄÇÂú®ÂêØÁî®‰∫ÜËôöÊãüÂåñÊâ©Â±ïÁöÑÊÉÖÂÜµ‰∏ãÔºåÁâπÊùÉÁ∫ßÁöÑÊú∫Âà∂‰ºöÊúâÊâÄÊâ©Â±ïÔºåÁî®‰∫éÊîØÊåÅËôöÊãüÊú∫ÁõëÊéßÁ®ãÂ∫èÔºàHypervisorÔºâÁ≠âËôöÊãüÂåñÁéØÂ¢ÉÁöÑÁÆ°ÁêÜ„ÄÇ</li>
</ul>
</li>
<li><p><strong>Êú∫Âô®Ê®°ÂºèÔºàMachine Mode, MÔºâ</strong>Ôºö</p>
<ul>
<li>Êú∫Âô®Ê®°ÂºèÊòØRISC-VÁöÑÊúÄÈ´òÁâπÊùÉÁ∫ßÔºåÈÄöÂ∏∏Áî±Âõ∫‰ª∂ÊàñÂêØÂä®Á®ãÂ∫èÔºàÂ¶ÇÂºïÂØºÂä†ËΩΩÁ®ãÂ∫èÔºâ‰ΩøÁî®„ÄÇ</li>
<li>Âú®Êú∫Âô®Ê®°Âºè‰∏ãÔºåCPUÂÖ∑ÊúâÊúÄÈ´òÁöÑËÆøÈóÆÊùÉÈôêÔºåÂèØ‰ª•ËÆøÈóÆÊâÄÊúâÁ°¨‰ª∂ËµÑÊ∫ê„ÄÇ</li>
<li>Êú∫Âô®Ê®°ÂºèÈÄöÂ∏∏Áî®‰∫éÊâßË°åÊúÄ‰ΩéÁ∫ßÂà´ÁöÑÊìç‰ΩúÔºåÂ¶ÇËÆæÁΩÆÁ≥ªÁªüÂÆöÊó∂Âô®„ÄÅÂêØÂä®ÂíåÂÖ≥Èó≠Á°¨‰ª∂„ÄÅÂ§ÑÁêÜÊïÖÈöúÁ≠â„ÄÇ</li>
</ul>
</li>
</ol>
<p>ÁâπÊùÉÁ∫ßÁöÑÂàáÊç¢ÈÄöËøáRISC-V Êèê‰æõÁöÑÊú∫Âô®Êåá‰ª§ÔºöÊâßË°åÁéØÂ¢ÉË∞ÉÁî®Êåá‰ª§ÔºàExecution Environment CallÔºåÁÆÄÁß∞¬†<code>ecall</code>¬†ÔºâÂíå‰∏ÄÁ±ªÊâßË°åÁéØÂ¢ÉËøîÂõûÔºàExecution Environment ReturnÔºåÁÆÄÁß∞¬†<code>eret</code>¬†ÔºâÊåá‰ª§Êù•ÂÆåÊàê„ÄÇÂØπ‰∫éÊú¨Á´†ËøôÊ†∑ÁöÑÊâπÂ§ÑÁêÜÁ≥ªÁªüÔºå2ÁßçÁâπÊùÉÁ∫ßÂ∞±Ë∂≥Â§ü‰∫Ü„ÄÇ</p>
<p>ÂºÇÂ∏∏ÔºàExceptionÔºâÊòØRISC-V‰ΩìÁ≥ª‰∏≠‰∏ÄÁßçÁâπÊÆäÁöÑÊéßÂà∂ÊµÅÔºàÂç≥‚ÄúÂºÇÂ∏∏ÊéßÂà∂ÊµÅ‚ÄùÔºâ„ÄÇÂÆÉ‰ª£Ë°®Á®ãÂ∫èÂú®ÊâßË°åÊó∂ÂèëÁîü‰∫ÜÊÑèÂ§ñÁöÑË°å‰∏∫Êàñ‰∫ã‰ª∂ÔºåËøô‰∫õ‰∫ã‰ª∂ÈúÄË¶ÅÁ®ãÂ∫è‰∏≠Êñ≠Ê≠£Â∏∏ÁöÑÊâßË°åÈ°∫Â∫èÂπ∂Ë∑≥ËΩ¨Âà∞Êüê‰∏™ÂºÇÂ∏∏Â§ÑÁêÜÁ®ãÂ∫èÔºà‰æãÂ¶ÇÔºåÊìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÁöÑÂºÇÂ∏∏Â§ÑÁêÜ‰ª£Á†ÅÔºâ„ÄÇ</p>
<p>Âú®RISC-V‰∏≠ÔºåÂºÇÂ∏∏ÊéßÂà∂ÊµÅ‰∏éÂ∏∏ËßÑÁöÑÁ®ãÂ∫èÊéßÂà∂ÊµÅÔºàÂ¶ÇÈ°∫Â∫èÊâßË°å„ÄÅÂæ™ÁéØ„ÄÅÂàÜÊîØ„ÄÅÂáΩÊï∞Ë∞ÉÁî®Á≠âÔºâÊòØ‰∏çÂêåÁöÑ„ÄÇÁ®ãÂ∫èÂú®ÂºÇÂ∏∏ÂèëÁîüÊó∂‰ºö‰∏≠Êñ≠Ê≠£Â∏∏ÁöÑÊâßË°åÊµÅÁ®ãÔºåÂπ∂ËΩ¨Âà∞ÂºÇÂ∏∏Â§ÑÁêÜ‰ª£Á†Å‰∏≠„ÄÇÂ§ÑÁêÜÂÆåÂºÇÂ∏∏ÂêéÔºåÁ®ãÂ∫èÈÄöÂ∏∏‰ºöÊÅ¢Â§çÂéüÊú¨ÁöÑÊâßË°åÊµÅ„ÄÇ</p>
<p>TrapÊòØRISC-V‰∏≠‰∏ÄÁßç‚Äú‰∏≠Êñ≠‚ÄùÊú∫Âà∂ÁöÑÁªüÁß∞ÔºåÂåÖÊã¨‰ΩÜ‰∏çÈôê‰∫éÂºÇÂ∏∏„ÄÇÂú®RISC-VÊû∂ÊûÑ‰∏≠ÔºåÂºÇÂ∏∏Â±û‰∫éTrapÁöÑ‰∏ÄÁßçÁ±ªÂûã„ÄÇÂºÇÂ∏∏ÈÄöÂ∏∏ÂèëÁîüÂú®Êåá‰ª§ÊâßË°åËøáÁ®ã‰∏≠ÔºåÂèØËÉΩÊòØÂõ†‰∏∫Á®ãÂ∫èÈîôËØØ„ÄÅÁ≥ªÁªüË∞ÉÁî®„ÄÅÂ§ñÈÉ®Á°¨‰ª∂‰∏≠Êñ≠Á≠â‰∫ã‰ª∂„ÄÇËøô‰∫õ‰∫ã‰ª∂ÈúÄË¶ÅÊìç‰ΩúÁ≥ªÁªüÊàñÁ°¨‰ª∂ËøõË°åÂ§ÑÁêÜÔºåÂπ∂Âú®Â§ÑÁêÜÂÆåÊàêÂêéÊÅ¢Â§çÁ®ãÂ∫èÊâßË°å„ÄÇ</p>
<blockquote>
<p>¬†<strong>Êñ≠ÁÇπ</strong>¬†(Breakpoint) Âíå¬†<strong>ÊâßË°åÁéØÂ¢ÉË∞ÉÁî®</strong>¬†(Environment call) ‰∏§ÁßçÂºÇÂ∏∏Ôºà‰∏∫‰∫Ü‰∏éÂÖ∂‰ªñÈùûÊúâÊÑè‰∏∫‰πãÁöÑÂºÇÂ∏∏Âå∫ÂàÜÔºå‰ºöÊääËøôÁßçÊúâÊÑè‰∏∫‰πãÁöÑÊåá‰ª§Áß∞‰∏∫¬†<em>Èô∑ÂÖ•</em>¬†Êàñ¬†<em>trap</em>¬†Á±ªÊåá‰ª§ÔºåÊ≠§Â§ÑÁöÑÈô∑ÂÖ•‰∏∫Êìç‰ΩúÁ≥ªÁªü‰∏≠‰º†ÁªüÊ¶ÇÂøµÔºâÊòØÈÄöËøáÂú®‰∏äÂ±ÇËΩØ‰ª∂‰∏≠ÊâßË°å‰∏ÄÊù°ÁâπÂÆöÁöÑÊåá‰ª§Ëß¶ÂèëÁöÑÔºöÊâßË°å¬†<code>ebreak</code>¬†ËøôÊù°Êåá‰ª§‰πãÂêéÂ∞±‰ºöËß¶ÂèëÊñ≠ÁÇπÈô∑ÂÖ•ÂºÇÂ∏∏ÔºõËÄåÊâßË°å¬†<code>ecall</code>¬†ËøôÊù°Êåá‰ª§Êó∂ÂÄôÂàô‰ºöÈöèÁùÄ CPU ÂΩìÂâçÊâÄÂ§ÑÁâπÊùÉÁ∫ßËÄåËß¶Âèë‰∏çÂêåÁöÑÂºÇÂ∏∏„ÄÇ</p>
</blockquote>
<p>ÂΩì‰∏Ä‰∏™ÁâπÊùÉÁ∫ßÂàáÊç¢ÔºàÈÄöÂ∏∏ÊòØÂõ†‰∏∫ÂºÇÂ∏∏Êàñ‰∏≠Êñ≠ÔºâÂèëÁîüÊó∂ÔºåCPU‰ºö‰∏≠Êñ≠ÂΩìÂâçÊâßË°åÁöÑ‰ª£Á†ÅÔºåÂπ∂ÂàáÊç¢Âà∞Êõ¥È´òÁâπÊùÉÁ∫ßÁöÑ‰ª£Á†Å„ÄÇÂ§ÑÁêÜÂÆåÂºÇÂ∏∏ÂêéÔºåCPUÈúÄË¶ÅËøîÂõûÂà∞Ë¢´‰∏≠Êñ≠ÁöÑÁ®ãÂ∫èÔºåÁªßÁª≠‰ªéÂéüÊù•ÊöÇÂÅúÁöÑ‰ΩçÁΩÆÊÅ¢Â§çÊâßË°å„ÄÇËøôÁßçÊÅ¢Â§çÊâßË°åÁöÑËøáÁ®ãÂú®RISC-V‰∏≠ÈÄöÂ∏∏‰ºöÈÄöËøá<strong>ÂºÇÂ∏∏ËøîÂõû</strong>ÔºàException ReturnÔºâÊú∫Âà∂Êù•ÂÆûÁé∞„ÄÇÂÆÉÈÄöËøáÂ≠òÂÇ®ÂíåÊÅ¢Â§çÂΩìÂâçÊâßË°åÁä∂ÊÄÅÊù•Á°Æ‰øùÁ®ãÂ∫èËÉΩÂ§üÂú®Ê≠£Á°ÆÁöÑÂú∞ÊñπÁªßÁª≠ÊâßË°å„ÄÇ</p>
<p>ÂΩìÊüê‰∫õÊìç‰ΩúÊàñËØ∑Ê±ÇÈúÄË¶ÅÁî±Êõ¥È´òÊùÉÈôêÁöÑ‰ª£Á†ÅÂ§ÑÁêÜÊó∂ÔºåCPU‰ºö‰ªéËæÉ‰ΩéÊùÉÈôêÁ∫ßÂàáÊç¢Âà∞ËæÉÈ´òÊùÉÈôêÁ∫ß„ÄÇËøôÊó∂Â∞±ÈúÄË¶ÅÂàáÊç¢ÊâßË°åÁéØÂ¢ÉÂπ∂ÊâßË°åÂøÖË¶ÅÁöÑÊìç‰Ωú„ÄÇ<br><a href="/img/rCore/asserts/Pasted%20image%2020250207160741.png" class="gallery-item" style="box-shadow: none;"> <img src="/img/rCore/asserts/Pasted%20image%2020250207160741.png"></a></p>
<h2 id="ÂÆûÁé∞Â∫îÁî®Á®ãÂ∫è"><a href="#ÂÆûÁé∞Â∫îÁî®Á®ãÂ∫è" class="headerlink" title="ÂÆûÁé∞Â∫îÁî®Á®ãÂ∫è"></a>ÂÆûÁé∞Â∫îÁî®Á®ãÂ∫è</h2><p>Êú¨ËäÇ‰∏ªË¶ÅËÆ≤Ëß£Â¶Ç‰ΩïËÆæËÆ°ÂÆûÁé∞Ë¢´ÊâπÂ§ÑÁêÜÁ≥ªÁªüÈÄê‰∏™Âä†ËΩΩÂπ∂ËøêË°åÁöÑÂ∫îÁî®Á®ãÂ∫è„ÄÇÂÅáÂÆöÂú®Áî®Êà∑ÊÄÅ‰∏ãËøêË°å„ÄÇÂ∫îÁî®Á®ãÂ∫èÁöÑËÆæËÆ°ÂÆûÁé∞Ë¶ÅÁÇπÊòØÂÜÖÂ≠òÂ∏ÉÂ±ÄÂíåËÆæËÆ°Á≥ªÁªüË∞ÉÁî®„ÄÇ</p>
<p>Âú®¬†<code>user/src</code>¬†ÁõÆÂΩï‰∏ãÔºå<code>bin</code>¬†ÈáåÈù¢ÊúâÂ§ö‰∏™Áî®Êà∑Á®ãÂ∫èÊñá‰ª∂Ôºå<code>user</code>¬†ÁõÆÂΩï‰∏ãÁöÑ¬†<code>lib.rs</code>¬†‰ª•ÂèäÂÆÉÂºïÁî®ÁöÑËã•Âπ≤Â≠êÊ®°Âùó‰Ωú‰∏∫¬†<code>bin</code>¬†ÁõÆÂΩï‰∏ãÁöÑÊ∫êÁ®ãÂ∫èÊâÄ‰æùËµñÁöÑÁî®Êà∑Â∫ìÔºåÁ≠â‰ª∑‰∫éÂÖ∂‰ªñÁºñÁ®ãËØ≠Ë®ÄÊèê‰æõÁöÑÊ†áÂáÜÂ∫ìÔºåÂÆö‰πâ‰∫ÜÁî®Êà∑Â∫ìÁöÑÂÖ•Âè£ÁÇπÔºåÂ∞ÅË£Ö‰∫Ü‰∏Ä‰∫õ<code>syscall</code>„ÄÇ</p>
<p>Á≥ªÁªüË∞ÉÁî®ÂÆûÈôÖ‰∏äÊòØÊ±áÁºñÊåá‰ª§Á∫ßÂà´ÁöÑ‰∫åËøõÂà∂Êé•Âè£ÔºåÂú®ÂÖ∑‰ΩìÂÆûÁé∞ÁöÑÊó∂ÂÄôÔºåÈúÄË¶Å‰ΩøÁî®ÂÜÖËÅîÊ±áÁºñÔºåÂú®ÊåáÂÆöÁöÑÂØÑÂ≠òÂô®‰∏≠ÊîæÂÖ•ÂèÇÊï∞„ÄÇÂú® RISC-V Ë∞ÉÁî®ËßÑËåÉ‰∏≠ÔºåÁ∫¶ÂÆöÂØÑÂ≠òÂô®¬†<code>a0~a6</code>¬†‰øùÂ≠òÁ≥ªÁªüË∞ÉÁî®ÁöÑÂèÇÊï∞Ôºå¬†<code>a0</code>¬†‰øùÂ≠òÁ≥ªÁªüË∞ÉÁî®ÁöÑËøîÂõûÂÄºÔºå¬†<code>a7</code>¬†Áî®Êù•‰º†ÈÄí syscall ID„ÄÇ</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">syscall</span>(id: <span class="type">usize</span>, args: [<span class="type">usize</span>; <span class="number">3</span>]) <span class="punctuation">-&gt;</span> <span class="type">isize</span> {</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ret</span>: <span class="type">isize</span>;</span><br><span class="line">    <span class="keyword">unsafe</span> {</span><br><span class="line">        asm!(</span><br><span class="line">            <span class="string">"ecall"</span>,</span><br><span class="line">            <span class="title function_ invoke__">inlateout</span>(<span class="string">"x10"</span>) args[<span class="number">0</span>] =&gt; ret,</span><br><span class="line">            <span class="title function_ invoke__">in</span>(<span class="string">"x11"</span>) args[<span class="number">1</span>],</span><br><span class="line">            <span class="title function_ invoke__">in</span>(<span class="string">"x12"</span>) args[<span class="number">2</span>],</span><br><span class="line">            <span class="title function_ invoke__">in</span>(<span class="string">"x17"</span>) id</span><br><span class="line">	    );</span><br><span class="line">    }</span><br><span class="line">    ret</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>‰∫éÊòØÁî®Êà∑Â∫ì‰∏≠ÁöÑ¬†<code>sys_write</code>¬†Âíå¬†<code>sys_exit</code>¬†Á≠âÁ≥ªÁªüË∞ÉÁî®Âè™ÈúÄÂ∞Ü¬†<code>syscall</code>¬†ËøõË°åÂåÖË£ÖÂç≥ÂèØÔºö</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/src/syscall.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SYSCALL_WRITE: <span class="type">usize</span> = <span class="number">64</span>;</span><br><span class="line"><span class="keyword">const</span> SYSCALL_EXIT: <span class="type">usize</span> = <span class="number">93</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sys_write</span>(fd: <span class="type">usize</span>, buffer: &amp;[<span class="type">u8</span>]) <span class="punctuation">-&gt;</span> <span class="type">isize</span> {</span><br><span class="line">    <span class="title function_ invoke__">syscall</span>(SYSCALL_WRITE, [fd, buffer.<span class="title function_ invoke__">as_ptr</span>() <span class="keyword">as</span> <span class="type">usize</span>, buffer.<span class="title function_ invoke__">len</span>()])</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sys_exit</span>(xstate: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">isize</span> {</span><br><span class="line">    <span class="title function_ invoke__">syscall</span>(SYSCALL_EXIT, [xstate <span class="keyword">as</span> <span class="type">usize</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="ÂÆûÁé∞ÊâπÂ§ÑÁêÜÊìç‰ΩúÁ≥ªÁªü"><a href="#ÂÆûÁé∞ÊâπÂ§ÑÁêÜÊìç‰ΩúÁ≥ªÁªü" class="headerlink" title="ÂÆûÁé∞ÊâπÂ§ÑÁêÜÊìç‰ΩúÁ≥ªÁªü"></a>ÂÆûÁé∞ÊâπÂ§ÑÁêÜÊìç‰ΩúÁ≥ªÁªü</h2><blockquote>
<p>‰ªéÊú¨ËäÇÂºÄÂßãÊàë‰ª¨Â∞ÜÁùÄÊâãÂÆûÁé∞ÊâπÂ§ÑÁêÜÊìç‰ΩúÁ≥ªÁªüÔºåÂ∫îÁî®ÊîæÁΩÆÈááÁî®‚ÄúÈùôÊÄÅÁªëÂÆö‚ÄùÁöÑÊñπÂºèÔºåËÄåÊìç‰ΩúÁ≥ªÁªüÂä†ËΩΩÂ∫îÁî®ÂàôÈááÁî®‚ÄúÂä®ÊÄÅÂä†ËΩΩ‚ÄùÁöÑÊñπÂºèÔºö</p>
<ul>
<li><p>ÈùôÊÄÅÁªëÂÆöÔºöÈÄöËøá‰∏ÄÂÆöÁöÑÁºñÁ®ãÊäÄÂ∑ßÔºåÊääÂ§ö‰∏™Â∫îÁî®Á®ãÂ∫è‰ª£Á†ÅÂíåÊâπÂ§ÑÁêÜÊìç‰ΩúÁ≥ªÁªü‰ª£Á†Å‚ÄúÁªëÂÆö‚ÄùÂú®‰∏ÄËµ∑„ÄÇ</p>
</li>
<li><p>Âä®ÊÄÅÂä†ËΩΩÔºöÂü∫‰∫éÈùôÊÄÅÁºñÁ†ÅÁïô‰∏ãÁöÑ‚ÄúÁªëÂÆö‚Äù‰ø°ÊÅØÔºåÊìç‰ΩúÁ≥ªÁªüÂèØ‰ª•ÊâæÂà∞ÊØè‰∏™Â∫îÁî®Á®ãÂ∫èÊñá‰ª∂‰∫åËøõÂà∂‰ª£Á†ÅÁöÑËµ∑ÂßãÂú∞ÂùÄÂíåÈïøÂ∫¶ÔºåÂπ∂ËÉΩÂä†ËΩΩÂà∞ÂÜÖÂ≠ò‰∏≠ËøêË°å„ÄÇ</p>
</li>
</ul>
</blockquote>
<p>Êï¥‰ΩìÁöÑÊµÅÁ®ã‰∏∫ÔºöÊìç‰ΩúÁ≥ªÁªüÂàùÂßãÂåñÊ†àÂíå‰∏ä‰∏ãÊñáÔºåÂä†ËΩΩÂ∫îÁî®Á®ãÂ∫èÔºåÂàáÊç¢Âà∞Áî®Êà∑ÊÄÅÔºåÂ∫îÁî®Á®ãÂ∫èÂºÄÂßãËøêË°åÔºåÂèØËÉΩ‰ºöË∞ÉÁî®Á≥ªÁªüË∞ÉÁî®Ëé∑ÂèñÊìç‰ΩúÁ≥ªÁªüÁöÑÊúçÂä°ÔºåÂ∫îÁî®Á®ãÂ∫èÈÄÄÂá∫‰πü‰ΩøÁî®‰∫Ü‰∏ÄÁßçÁ≥ªÁªüË∞ÉÁî®ÔºåÂÖ∂‰∏≠‰ºöÂä†ËΩΩ‰∏ã‰∏Ä‰∏™Â∫îÁî®Á®ãÂ∫è„ÄÇ</p>
<h2 id="ÂÆûÁé∞ÁâπÊùÉÁ∫ßÁöÑÂàáÊç¢"><a href="#ÂÆûÁé∞ÁâπÊùÉÁ∫ßÁöÑÂàáÊç¢" class="headerlink" title="ÂÆûÁé∞ÁâπÊùÉÁ∫ßÁöÑÂàáÊç¢"></a>ÂÆûÁé∞ÁâπÊùÉÁ∫ßÁöÑÂàáÊç¢</h2><p>Â∫îÁî®Á®ãÂ∫è‰∏éÊìç‰ΩúÁ≥ªÁªüËøêË°åÂú®‰∏çÂêåÁöÑÁâπÊùÉÁ∫ßÔºåÁâπÊùÉÁ∫ßÁöÑÂàáÊç¢ÈúÄË¶ÅÊìç‰ΩúÁ≥ªÁªüÂíåÁ°¨‰ª∂ËÆæÊñΩÈÄöËøáÊüêÁßçÂêà‰ΩúÊú∫Âà∂ÂÖ±ÂêåÂÆåÊàê„ÄÇ</p>
<p>ÂàáÊç¢ÈÄöÂ∏∏ÊòØÁî±‰∏≠Êñ≠„ÄÅÂºÇÂ∏∏ÊàñÁ≥ªÁªüË∞ÉÁî®ÂºïÂèëÁöÑ„ÄÇÂΩìÊìç‰ΩúÁ≥ªÁªüÈúÄË¶ÅÊâßË°åÁâπÊùÉÊìç‰ΩúÊó∂ÔºåÂÆÉ‰ºöÈÄöËøá‰∏≠Êñ≠ÊàñÂºÇÂ∏∏Â∞ÜÂΩìÂâçÊâßË°åÁöÑÁ®ãÂ∫è‰ªéÁî®Êà∑Ê®°ÂºèÔºàU-modeÔºâÂàáÊç¢Âà∞Ë∂ÖÁ∫ßÁî®Êà∑Ê®°ÂºèÔºàS-modeÔºâ„ÄÇÂú® RISC-V Êû∂ÊûÑ‰∏≠ÔºåÂÖ≥‰∫é Trap Êúâ‰∏ÄÊù°ÈáçË¶ÅÁöÑËßÑÂàôÔºöÂú® Trap ÂâçÁöÑÁâπÊùÉÁ∫ß‰∏ç‰ºöÈ´ò‰∫é Trap ÂêéÁöÑÁâπÊùÉÁ∫ß„ÄÇÂõ†Ê≠§Â¶ÇÊûúËß¶Âèë Trap ‰πãÂêéÂàáÊç¢Âà∞ S ÁâπÊùÉÁ∫ßÔºà‰∏ãÁß∞ Trap Âà∞ SÔºâÔºåËØ¥Êòé Trap ÂèëÁîü‰πãÂâç CPU Âè™ËÉΩËøêË°åÂú® S/U ÁâπÊùÉÁ∫ß„ÄÇ</p>
<p>RISC-VÊû∂ÊûÑ‰ΩøÁî®ÊéßÂà∂Áä∂ÊÄÅÂØÑÂ≠òÂô®ÔºàCSRÔºåControl and Status RegisterÔºâÊù•ÁÆ°ÁêÜÁâπÊùÉÁ∫ßÂà´ÂíåÁä∂ÊÄÅÔºåRISC-VÊúâÂ§ö‰∏™‰∏ìÈó®ÁöÑÂØÑÂ≠òÂô®Êù•Â§ÑÁêÜÁâπÊùÉÁ∫ßÂàáÊç¢Ôºö</p>
<ul>
<li><p><strong>sstatus</strong>¬†(Supervisor Status Register)</p>
<ul>
<li><code>sstatus</code>ÂØÑÂ≠òÂô®Áî®‰∫é‰øùÂ≠òÂíåÁÆ°ÁêÜË∂ÖÁ∫ßÁî®Êà∑Ê®°ÂºèÔºàS-modeÔºâÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÔºåÂÖ≥‰∫éÁâπÊùÉÁ∫ßÂà´ÂàáÊç¢„ÄÅÂºÇÂ∏∏Âíå‰∏≠Êñ≠ÁöÑÁä∂ÊÄÅ„ÄÇ</li>
<li><strong>SPP</strong>ÔºàSupervisor Previous PrivilegeÔºâÔºöËÆ∞ÂΩï Trap ÂèëÁîü‰πãÂâç CPU Â§ÑÂú®Âì™‰∏™ÁâπÊùÉÁ∫ßÂà´„ÄÇÂÆÉÁöÑÂÄº‰∏∫Ôºö<ul>
<li><code>0</code>ÔºöÁî®Êà∑Ê®°ÂºèÔºàU-modeÔºâ</li>
<li><code>1</code>ÔºöË∂ÖÁ∫ßÁî®Êà∑Ê®°ÂºèÔºàS-modeÔºâ</li>
</ul>
</li>
<li><strong>SIE</strong>ÔºàSupervisor Interrupt EnableÔºâÔºöË°®Á§∫ÊòØÂê¶ÂÖÅËÆ∏Ë∂ÖÁ∫ßÁî®Êà∑Ê®°Âºè‰∏ãÁöÑ‰∏≠Êñ≠„ÄÇ</li>
<li><strong>SPIE</strong>ÔºàSupervisor Previous Interrupt EnableÔºâÔºöË°®Á§∫ Trap ÂèëÁîü‰πãÂâçÔºåË∂ÖÁ∫ßÁî®Êà∑Ê®°Âºè‰∏ãÊòØÂê¶ÂÖÅËÆ∏‰∏≠Êñ≠„ÄÇ</li>
<li><strong>SUM</strong>ÔºàSupervisor User Memory AccessÔºâÔºöË°®Á§∫ÊòØÂê¶ÂÖÅËÆ∏Ë∂ÖÁ∫ßÁî®Êà∑Ê®°ÂºèËÆøÈóÆÁî®Êà∑Á∫ßÂà´ÁöÑÂÜÖÂ≠ò„ÄÇ</li>
<li><strong>MPRV</strong>ÔºàModify PrivilegeÔºâÔºöÊéßÂà∂ÊòØÂê¶ÂÖÅËÆ∏Âú®Ë∂ÖÁ∫ßÁî®Êà∑Ê®°Âºè‰∏ã‰øÆÊîπÂÜÖÂ≠òÁöÑËÆøÈóÆÊùÉÈôê„ÄÇ</li>
</ul>
<ul>
<li><strong>Áî®ÈÄî</strong>Ôºö<code>sstatus</code> ÂØÑÂ≠òÂô®Â∏ÆÂä©Êìç‰ΩúÁ≥ªÁªüÁÆ°ÁêÜÁâπÊùÉÁ∫ßÂà´ÂàáÊç¢Ôºå‰øùÂ≠òÂΩìÂâçÁöÑ‰∏≠Êñ≠ÂêØÁî®Áä∂ÊÄÅÔºå‰ª•ÂèäÊéßÂà∂Ë∂ÖÁ∫ßÁî®Êà∑Ê®°Âºè‰∏ãÁöÑÂÜÖÂ≠òËÆøÈóÆ„ÄÇ</li>
</ul>
</li>
<li><p><strong>sepc</strong>¬†(Supervisor Exception Program Counter)</p>
<ul>
<li><strong>ÂäüËÉΩ</strong>Ôºö<code>sepc</code>ÂØÑÂ≠òÂô®‰øùÂ≠òÂèëÁîüÂºÇÂ∏∏Êàñ‰∏≠Êñ≠Êó∂ÔºåË∂ÖÁ∫ßÁî®Êà∑Ê®°ÂºèÔºàS-modeÔºâÁ®ãÂ∫èËÆ°Êï∞Âô®ÁöÑÂÄºÔºåÂç≥Âú® Trap ÂèëÁîü‰πãÂâçÊ≠£Âú®ÊâßË°åÁöÑÊåá‰ª§ÁöÑÂú∞ÂùÄ„ÄÇ</li>
<li><strong>Áî®ÈÄî</strong>ÔºöÂÆÉ‰ΩøÂæóÂ§ÑÁêÜÂºÇÂ∏∏Êó∂ÔºåCPU ÂèØ‰ª•Ë∑≥ËΩ¨Âà∞Ê≠£Á°ÆÁöÑÂºÇÂ∏∏Â§ÑÁêÜ‰ª£Á†Å„ÄÇÂºÇÂ∏∏Â§ÑÁêÜÁ®ãÂ∫èÂèØ‰ª•ËØªÂèñ¬†<code>sepc</code>¬†ÁöÑÂÄºÊù•Áü•ÈÅìÊòØÂì™Êù°Êåá‰ª§ÂØºËá¥ÁöÑÂºÇÂ∏∏„ÄÇ</li>
</ul>
</li>
<li><p><strong>scause</strong>¬†(Supervisor Cause Register)</p>
<ul>
<li><strong>ÂäüËÉΩ</strong>Ôºö<code>scause</code>ÂØÑÂ≠òÂô®Áî®Êù•ËÆ∞ÂΩï Trap ÂèëÁîüÁöÑÂéüÂõ†ÔºåÂÆÉÊåáÁ§∫ÊòØÂì™ÁßçÂºÇÂ∏∏Êàñ‰∏≠Êñ≠Ëß¶Âèë‰∫Ü Trap„ÄÇ</li>
<li><strong>Exception Code</strong>ÔºöÂØÑÂ≠òÂô®ÁöÑÈ´ò‰ΩçÈÉ®ÂàÜËÆ∞ÂΩïÂºÇÂ∏∏ÁöÑÁ±ªÂûãÔºåÂ¶ÇÈùûÊ≥ïÊåá‰ª§„ÄÅËÆøÈóÆÊùÉÈôêÈîôËØØÁ≠â„ÄÇÂºÇÂ∏∏‰ª£Á†Å‰∏é‰∏≠Êñ≠‰ª£Á†ÅÁî±‰∏çÂêåÁöÑÂÄºË°®Á§∫„ÄÇ</li>
<li><strong>Interrupt Flag</strong>Ôºö‰Ωé‰ΩçÊ†áËÆ∞Ë°®Á§∫ Trap ÊòØÁî±‰∏≠Êñ≠ÂºïÂèëÁöÑÔºà‰∏∫ 1ÔºâÔºåËøòÊòØÁî±ÂºÇÂ∏∏ÂºïËµ∑ÁöÑÔºà‰∏∫ 0Ôºâ„ÄÇ</li>
</ul>
<ul>
<li><strong>Áî®ÈÄî</strong>Ôºö<code>scause</code> ÂØÑÂ≠òÂô®Â∏ÆÂä©Êìç‰ΩúÁ≥ªÁªüÊàñÂºÇÂ∏∏Â§ÑÁêÜÁ®ãÂ∫èËØÜÂà´ÂÖ∑‰ΩìÁöÑÂºÇÂ∏∏Á±ªÂûãÔºå‰ª•‰æøÈááÂèñÈÄÇÂΩìÁöÑÂ§ÑÁêÜÊé™ÊñΩ„ÄÇ</li>
</ul>
</li>
<li><p><strong>stval</strong>¬†(Supervisor Trap Value Register)</p>
<ul>
<li><strong>ÂäüËÉΩ</strong>Ôºö<code>stval</code>ÂØÑÂ≠òÂô®‰øùÂ≠ò‰∏é Trap Áõ∏ÂÖ≥ÁöÑÈôÑÂä†‰ø°ÊÅØ„ÄÇÂØπ‰∫é‰∏çÂêåÁ±ªÂûãÁöÑÂºÇÂ∏∏Êàñ‰∏≠Êñ≠ÔºåËøô‰∏™ÂØÑÂ≠òÂô®ÁöÑÂê´‰πâÂèØËÉΩ‰∏çÂêå„ÄÇÂÆÉÈÄöÂ∏∏Áî®‰∫éÂ≠òÂÇ®Ëß¶ÂèëÂºÇÂ∏∏ÁöÑÁõ∏ÂÖ≥Êï∞ÊçÆ„ÄÇ</li>
<li><strong>Áî®ÈÄî</strong>Ôºö</li>
<li>Âú®ËÆøÈóÆÊùÉÈôêÂºÇÂ∏∏Ôºà‰æãÂ¶ÇÔºåËÆøÈóÆÈùûÊ≥ïÂú∞ÂùÄÊó∂ÔºâÔºå<code>stval</code>¬†ÂèØ‰ª•‰øùÂ≠òÂá∫ÈîôÁöÑËôöÊãüÂú∞ÂùÄ„ÄÇ</li>
<li>Âú®Âä†ËΩΩÊàñÂ≠òÂÇ®Êåá‰ª§ÂºÇÂ∏∏Êó∂Ôºå<code>stval</code>¬†ÂèØËÉΩ‰øùÂ≠òÊåá‰ª§Âú∞ÂùÄ„ÄÇ</li>
<li>ÂØπ‰∫éÂÖ∂‰ªñÁ±ªÂûãÁöÑÂºÇÂ∏∏Ôºå<code>stval</code>¬†‰øùÂ≠òÈîôËØØÁõ∏ÂÖ≥ÁöÑÂÖ∑‰Ωì‰ø°ÊÅØ„ÄÇ</li>
</ul>
</li>
<li><p><strong>stvec</strong>¬†(Supervisor Trap Vector Register)</p>
<ul>
<li><strong>ÂäüËÉΩ</strong>Ôºö<code>stvec</code>ÂØÑÂ≠òÂô®ÊåáÂÆö Trap Â§ÑÁêÜÁ®ãÂ∫èÁöÑÂÖ•Âè£Âú∞ÂùÄÔºåÂç≥ÂΩìÂèëÁîüÂºÇÂ∏∏Êàñ‰∏≠Êñ≠Êó∂ÔºåCPU Â∫îËØ•Ë∑≥ËΩ¨Âà∞ÁöÑÂú∞ÂùÄ„ÄÇ</li>
<li><strong>Áõ¥Êé•Ê®°Âºè</strong>Ôºö<code>stvec</code>¬†Áõ¥Êé•ÊåáÂÆöÂºÇÂ∏∏Â§ÑÁêÜÁ®ãÂ∫èÁöÑÂú∞ÂùÄÔºåCPU Âú®ÂèëÁîü Trap Êó∂‰ºöË∑≥ËΩ¨Âà∞ËØ•Âú∞ÂùÄ„ÄÇ</li>
<li><strong>ÂêëÈáèÊ®°Âºè</strong>ÔºöÂ¶ÇÊûúÂêØÁî®‰∫ÜÂêëÈáèÊ®°ÂºèÔºå<code>stvec</code>¬†ÂØÑÂ≠òÂô®‰øùÂ≠òÁöÑÊòØ Trap ÂêëÈáèÁöÑÂü∫Âú∞ÂùÄ„ÄÇÂú®ÂêëÈáèÊ®°Âºè‰∏ãÔºåTrap ÁöÑÁ±ªÂûãÂÜ≥ÂÆö‰∫ÜË∑≥ËΩ¨ÁöÑÂÖ∑‰ΩìÂêëÈáèÂú∞ÂùÄ„ÄÇËøôÊ†∑ÂèØ‰ª•‰∏∫‰∏çÂêåÁ±ªÂûãÁöÑÂºÇÂ∏∏ËÆæÁΩÆ‰∏çÂêåÁöÑÂ§ÑÁêÜÂáΩÊï∞„ÄÇ</li>
<li><strong>Base Address</strong>Ôºö<code>stvec</code>¬†Â≠òÂÇ® Trap Â§ÑÁêÜÁ®ãÂ∫èÁöÑÂü∫Êú¨Âú∞ÂùÄ„ÄÇ</li>
<li><strong>Mode</strong>ÔºöÂÜ≥ÂÆöÊòØ‰ΩøÁî®Áõ¥Êé•Ê®°ÂºèËøòÊòØÂêëÈáèÊ®°ÂºèÔºåÈÄöÂ∏∏Áî±¬†<code>stvec</code>¬†ÁöÑÊúÄ‰Ωé‰ΩçÊéßÂà∂„ÄÇ</li>
</ul>
</li>
</ul>
<ul>
<li>Ëøô‰∫õÂØÑÂ≠òÂô®Â∏ÆÂä©Á≥ªÁªüÂÜ≥ÂÆö‰ªé‰∏Ä‰∏™Ê®°ÂºèÂà∞Âè¶‰∏Ä‰∏™Ê®°ÂºèÊó∂ÔºåÂ¶Ç‰Ωï‰øùÂ≠òÁä∂ÊÄÅÂπ∂ËøõË°åÊÅ¢Â§ç„ÄÇ</li>
</ul>
<ol>
<li>ÂΩìÂèëÁîü TrapÔºàÂ¶ÇÂºÇÂ∏∏Êàñ‰∏≠Êñ≠ÔºâÊó∂ÔºåCPU ‰ºö‰øùÂ≠òÂΩìÂâçÁöÑÁä∂ÊÄÅÔºà‰æãÂ¶ÇÔºåÁ®ãÂ∫èËÆ°Êï∞Âô®„ÄÅÁâπÊùÉÁ∫ßÂà´Á≠âÔºâÂà∞¬†<code>sepc</code>„ÄÅ<code>sstatus</code>¬†ÂíåÂÖ∂‰ªñÂØÑÂ≠òÂô®„ÄÇÂéüÂØÑÂ≠òÂô®Ë¢´‰øùÂ≠òÂú®ÂÜÖÊ†∏Ê†à‰∏≠„ÄÇ</li>
<li>ÁÑ∂ÂêéÔºåCPU ‰ºöÊ†πÊçÆ¬†<code>stvec</code>¬†Ë∑≥ËΩ¨Âà∞ Trap Â§ÑÁêÜÁ®ãÂ∫è„ÄÇ</li>
<li>Â§ÑÁêÜÁ®ãÂ∫èÂèØ‰ª•ÈÄöËøá¬†<code>scause</code>¬†Á°ÆÂÆö Trap ÁöÑÁ±ªÂûãÔºåÂπ∂ÈÄöËøá¬†<code>stval</code>¬†Ëé∑ÂèñÊõ¥Â§öÁöÑ‰ø°ÊÅØ„ÄÇ</li>
<li>Â§ÑÁêÜÁ®ãÂ∫èÂÆåÊàêÂêéÔºå‰ºöÊÅ¢Â§çÂéüÊù•ÁöÑÁä∂ÊÄÅÂπ∂ÁªßÁª≠ÊâßË°å„ÄÇ</li>
</ol>
<p>Âú®RISC-VÊû∂ÊûÑ‰∏≠ÔºåÁ°¨‰ª∂Âè™ÂÆåÊàêÂøÖÈ°ªË¶ÅÂÅöÁöÑÂ∑•‰ΩúÔºåÁªô‰∫ÜÊìç‰ΩúÁ≥ªÁªüÊõ¥Â§ßÁöÑÁÅµÊ¥ªÊÄß„ÄÇ</p>
<h2 id="ÂÜÖÊ†∏‰ª£Á†Å"><a href="#ÂÜÖÊ†∏‰ª£Á†Å" class="headerlink" title="ÂÜÖÊ†∏‰ª£Á†Å"></a>ÂÜÖÊ†∏‰ª£Á†Å</h2><p>ÊûÑÂª∫Êìç‰ΩúÁ≥ªÁªüÊó∂ÔºåËÑöÊú¨¬†<code>os/build.rs</code>¬†ÁîüÊàê‰∫Ü‰∏ÄÊÆµÊ±áÁºñ‰ª£Á†Å¬†<code>link_app.S</code>ÔºåÊèíÂÖ•‰∫ÜÂ∫îÁî®Á®ãÂ∫èÁöÑ‰∫åËøõÂà∂ÈïúÂÉèÔºåÂπ∂‰∏îÂêÑËá™Êúâ‰∏ÄÂØπÂÖ®Â±ÄÁ¨¶Âè∑¬†<code>app_*_start</code>Ôºå<code>app_*_end</code>¬†ÊåáÁ§∫ÂÆÉ‰ª¨ÁöÑÂºÄÂßãÂíåÁªìÊùü‰ΩçÁΩÆ„ÄÇ</p>
<h3 id="Á®ãÂ∫èÂä†ËΩΩ"><a href="#Á®ãÂ∫èÂä†ËΩΩ" class="headerlink" title="Á®ãÂ∫èÂä†ËΩΩ"></a>Á®ãÂ∫èÂä†ËΩΩ</h3><p>Â∫îÁî®ÁÆ°ÁêÜÂô®¬†<code>AppManager</code>¬†ÊòØÊìç‰ΩúÁ≥ªÁªüÁöÑÊ†∏ÂøÉÁªÑ‰ª∂Ôºö</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/batch.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AppManager</span> {</span><br><span class="line">    num_app: <span class="type">usize</span>,</span><br><span class="line">    current_app: <span class="type">usize</span>,</span><br><span class="line">    app_start: [<span class="type">usize</span>; MAX_APP_NUM + <span class="number">1</span>],</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>Â£∞ÊòéÂÖ®Â±ÄÂèòÈáèÁöÑÊó∂ÂÄôÔºåÈááÁî®¬†<code>static¬†mut</code>¬†ÊòØ‰∏ÄÁßçÊØîËæÉÁÆÄÂçïËá™ÁÑ∂ÁöÑÊñπÊ≥ï„ÄÇ‰ΩÜÊòØÂú® Rust ‰∏≠Ôºå‰ªª‰ΩïÂØπ‰∫é¬†<code>static¬†mut</code>¬†ÂèòÈáèÁöÑËÆøÈóÆÊéßÂà∂ÈÉΩÊòØ unsafe ÁöÑÔºåËÄåÊàë‰ª¨Ë¶ÅÂú®ÁºñÁ®ã‰∏≠Â∞ΩÈáèÈÅøÂÖç‰ΩøÁî® unsafe ÔºåËøôÊ†∑ÊâçËÉΩËÆ©ÁºñËØëÂô®Ë¥üË¥£Êõ¥Â§öÁöÑÂÆâÂÖ®ÊÄßÊ£ÄÊü•„ÄÇ‰ΩøÁî®<code>UPSafeCell</code>¬†ÂØπ‰∫é¬†<code>RefCell</code>¬†ÁÆÄÂçïËøõË°åÂ∞ÅË£ÖÔºåÂêëÁºñËØëÂô®ÂÅöÂá∫‰øùËØÅÔºåÊó†ÈúÄÂú®ÊÑè‰ªª‰ΩïÂ§öÊ†∏ÂºïÂèëÁöÑÊï∞ÊçÆÁ´û‰∫â/ÂêåÊ≠•ÈóÆÈ¢ò„ÄÇËôΩÁÑ∂¬†<code>UPSafeCell</code>¬†ÊòØÈÄöËøá¬†<code>unsafe</code>¬†ÂÆûÁé∞ÁöÑÔºå‰ΩÜÂÆÉÁöÑËÆæËÆ°Â∞ΩÈáèÂáèÂ∞ë‰∫Ü¬†<code>unsafe</code>¬†ÁöÑ‰ΩøÁî®ÔºåÂ∞ÜÂÖ∂Â∞ÅË£ÖÂú®ÂèóÊéßÁöÑËåÉÂõ¥ÂÜÖÔºå‰æùËµñ‰∫éÁ®ãÂ∫èÂëò‰øùËØÅÊï∞ÊçÆËÆøÈóÆÁöÑÂÆâÂÖ®ÊÄß„ÄÇÂÜç‰ΩøÁî®¬†<code>lazy_static!</code>¬†ÂÆèËøõË°åÂàùÂßãÂåñ„ÄÇ</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/sync/up.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">UPSafeCell</span>&lt;T&gt; {</span><br><span class="line">¬† ¬† <span class="comment">/// inner data</span></span><br><span class="line">¬† ¬† inner: RefCell&lt;T&gt;,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsafe</span> <span class="keyword">impl</span>&lt;T&gt; <span class="built_in">Sync</span> <span class="keyword">for</span> <span class="title class_">UPSafeCell</span>&lt;T&gt; {}</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; UPSafeCell&lt;T&gt; {</span><br><span class="line">¬† ¬† <span class="comment">/// User is responsible to guarantee that inner struct is only used in</span></span><br><span class="line">¬† ¬† <span class="comment">/// uniprocessor.</span></span><br><span class="line">¬† ¬† <span class="keyword">pub</span> <span class="keyword">unsafe</span> <span class="keyword">fn</span> <span class="title function_">new</span>(value: T) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> {</span><br><span class="line">¬† ¬† ¬† ¬† <span class="keyword">Self</span> {</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† inner: RefCell::<span class="title function_ invoke__">new</span>(value),</span><br><span class="line">¬† ¬† ¬† ¬† }</span><br><span class="line">¬† ¬† }</span><br><span class="line">¬† ¬† <span class="comment">/// Exclusive access inner data in UPSafeCell. Panic if the data has been borrowed.</span></span><br><span class="line">¬† ¬† <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">exclusive_access</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> RefMut&lt;<span class="symbol">'_</span>, T&gt; {</span><br><span class="line">¬† ¬† ¬† ¬† <span class="keyword">self</span>.inner.<span class="title function_ invoke__">borrow_mut</span>()</span><br><span class="line">¬† ¬† }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>Âú® Rust ‰∏≠ÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂ¶ÇÊûúÊúâ‰∏Ä‰∏™‰∏çÂèØÂèòÂºïÁî®Ôºà<code>&amp;T</code>ÔºâÔºåÂ∞±‰∏çËÉΩÈÄöËøáÂÆÉÊù•‰øÆÊîπÊï∞ÊçÆ„ÄÇËÄåÂ¶ÇÊûúÊúâ‰∏Ä‰∏™ÂèØÂèòÂºïÁî®Ôºà<code>&amp;mut T</code>ÔºâÔºåÂè™ËÉΩÊã•ÊúâËØ•Êï∞ÊçÆÁöÑÂîØ‰∏ÄÂèØÂèòÂºïÁî®„ÄÇ<code>RefCell</code> ÊâìÁ†¥‰∫ÜËøôÁßçÈôêÂà∂ÔºåÊèê‰æõ‰∫ÜÂÜÖÈÉ®ÂèØÂèòÊÄßÔºåÂÖÅËÆ∏Âú®ËøêË°åÊó∂ËøõË°åÂèØÂèòÂÄüÁî®Âíå‰∏çÂèØÂèòÂÄüÁî®ÁöÑÊ£ÄÊü•„ÄÇ</p>
<p><code>lazy_static!</code> ÂÆèÁî®‰∫éÂàõÂª∫Âª∂ËøüÂàùÂßãÂåñÁöÑÈùôÊÄÅÂèòÈáè„ÄÇÈùôÊÄÅÂèòÈáèÔºà<code>static</code>ÔºâÂú®Á®ãÂ∫èÁîüÂëΩÂë®ÊúüÂÜÖÂè™Êúâ‰∏Ä‰∏™ÂÆû‰æãÔºåÂπ∂‰∏îÈÄöÂ∏∏ÈúÄË¶ÅÂú®ÁºñËØëÊó∂ËøõË°åÂàùÂßãÂåñ„ÄÇÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨Â∏åÊúõÈùôÊÄÅÂèòÈáèÁöÑÂàùÂßãÂåñÊòØÂú®Á¨¨‰∏ÄÊ¨°‰ΩøÁî®Êó∂ÊâçÂèëÁîüÔºåËÄå‰∏çÊòØÂú®Á®ãÂ∫èÂêØÂä®Êó∂Â∞±ÂÆåÊàê„ÄÇËøôÂ∞±ÊòØ <code>lazy_static!</code> ÂÆèÁöÑ‰ΩúÁî®ÔºåÂÆÉÊèê‰æõ‰∫ÜÊáíÂàùÂßãÂåñÂäüËÉΩ„ÄÇ</p>
<p>Âä†ËΩΩÁ®ãÂ∫èÔºö</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsafe</span> <span class="keyword">fn</span> <span class="title function_">load_app</span>(&amp;<span class="keyword">self</span>, app_id: <span class="type">usize</span>) {</span><br><span class="line">    <span class="keyword">if</span> app_id &gt;= <span class="keyword">self</span>.num_app {</span><br><span class="line">		<span class="built_in">panic!</span>(<span class="string">"All applications completed!"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"[kernel] Loading app_{}"</span>, app_id);</span><br><span class="line">    <span class="comment">// clear app area</span></span><br><span class="line">    core::slice::<span class="title function_ invoke__">from_raw_parts_mut</span>(</span><br><span class="line">        APP_BASE_ADDRESS <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">u8</span>,</span><br><span class="line">        APP_SIZE_LIMIT</span><br><span class="line">    ).<span class="title function_ invoke__">fill</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">app_src</span> = core::slice::<span class="title function_ invoke__">from_raw_parts</span>(</span><br><span class="line">        <span class="keyword">self</span>.app_start[app_id] <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">u8</span>,</span><br><span class="line">        <span class="keyword">self</span>.app_start[app_id + <span class="number">1</span>] - <span class="keyword">self</span>.app_start[app_id]</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">app_dst</span> = core::slice::<span class="title function_ invoke__">from_raw_parts_mut</span>(</span><br><span class="line">        APP_BASE_ADDRESS <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">u8</span>,</span><br><span class="line">        app_src.<span class="title function_ invoke__">len</span>()</span><br><span class="line">    );</span><br><span class="line">    app_dst.<span class="title function_ invoke__">copy_from_slice</span>(app_src);</span><br><span class="line">    <span class="comment">// memory fence about fetching the instruction memory</span></span><br><span class="line">    asm!(<span class="string">"fence.i"</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Ë¥üË¥£Â∞ÜÂèÇÊï∞¬†<code>app_id</code>¬†ÂØπÂ∫îÁöÑÂ∫îÁî®Á®ãÂ∫èÁöÑ‰∫åËøõÂà∂ÈïúÂÉèÂä†ËΩΩÂà∞Áâ©ÁêÜÂÜÖÂ≠ò‰ª•¬†<code>0x80400000</code>¬†Ëµ∑ÂßãÁöÑ‰ΩçÁΩÆ„ÄÇÊ∏ÖÁ©∫ÁõÆÊ†áÂÜÖÂ≠òÂå∫ÂüüÔºåÂáÜÂ§áÂä†ËΩΩÂ∫îÁî®Á®ãÂ∫è„ÄÇËÆ°ÁÆóÂ∫îÁî®Á®ãÂ∫èÁöÑÈïøÂ∫¶ÔºåÊ†πÊçÆÊ∫êÂÜÖÂ≠òÁöÑËµ∑ÂßãÂú∞ÂùÄÂíåÈïøÂ∫¶ÔºåÂàõÂª∫‰∏Ä‰∏™‰∏çÂèØÂèòÁöÑÂàáÁâá¬†<code>app_src</code>ÔºåË°®Á§∫Â∫îÁî®Á®ãÂ∫èÁöÑÊ∫êÊï∞ÊçÆ„ÄÇÂ∞Ü¬†<code>app_src</code>¬†‰∏≠ÁöÑÊï∞ÊçÆÂ§çÂà∂Âà∞¬†<code>app_dst</code>¬†‰∏≠Ôºå‰πüÂ∞±ÊòØÂ∞ÜÂ∫îÁî®Á®ãÂ∫è‰ªéÊ∫êÂÜÖÂ≠òÂå∫ÂüüÂ§çÂà∂Âà∞ÁõÆÊ†áÂÜÖÂ≠òÂå∫Âüü„ÄÇÊúÄÂêéÊâßË°å‰∏Ä‰∏™ÂÜÖÂ≠òÂ±èÈöúÊåá‰ª§ÔºåÁ°Æ‰øùÂú®Âä†ËΩΩÂ∫îÁî®Á®ãÂ∫èÂêéÔºåÂ§ÑÁêÜÂô®ËÉΩÂ§üÂèäÊó∂Âú∞Êõ¥Êñ∞ÂÆÉÁöÑÊåá‰ª§ÁºìÂ≠òÔºåÈÅøÂÖçÂõ†‰∏∫ÁºìÂ≠òÈóÆÈ¢òÂØºËá¥ËØªÂèñÂà∞ËøáÊó∂ÁöÑÊåá‰ª§„ÄÇ</p>
<h3 id="Áî®Êà∑Ê†àÂíåÂÜÖÊ†∏Ê†à"><a href="#Áî®Êà∑Ê†àÂíåÂÜÖÊ†∏Ê†à" class="headerlink" title="Áî®Êà∑Ê†àÂíåÂÜÖÊ†∏Ê†à"></a>Áî®Êà∑Ê†àÂíåÂÜÖÊ†∏Ê†à</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/batch.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> USER_STACK_SIZE: <span class="type">usize</span> = <span class="number">4096</span> * <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> KERNEL_STACK_SIZE: <span class="type">usize</span> = <span class="number">4096</span> * <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> MAX_APP_NUM: <span class="type">usize</span> = <span class="number">16</span>;</span><br><span class="line"><span class="keyword">const</span> APP_BASE_ADDRESS: <span class="type">usize</span> = <span class="number">0x80400000</span>;</span><br><span class="line"><span class="keyword">const</span> APP_SIZE_LIMIT: <span class="type">usize</span> = <span class="number">0x20000</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[repr(align(4096))]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">KernelStack</span> {</span><br><span class="line">¬† ¬† data: [<span class="type">u8</span>; KERNEL_STACK_SIZE],</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">#[repr(align(4096))]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UserStack</span> {</span><br><span class="line">¬† ¬† data: [<span class="type">u8</span>; USER_STACK_SIZE],</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> KERNEL_STACK: KernelStack = KernelStack {</span><br><span class="line">¬† ¬† data: [<span class="number">0</span>; KERNEL_STACK_SIZE],</span><br><span class="line">};</span><br><span class="line"><span class="keyword">static</span> USER_STACK: UserStack = UserStack {</span><br><span class="line">¬† ¬† data: [<span class="number">0</span>; USER_STACK_SIZE],</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<ul>
<li><code>KernelStack</code>¬†Âíå¬†<code>UserStack</code>ÔºöÂàÜÂà´ÂÆö‰πâ‰∫ÜÂÜÖÊ†∏ÂíåÁî®Êà∑Ê†àÔºåÊØè‰∏™Ê†àÈÉΩ‰ª• 4096 Â≠óËäÇÂØπÈΩêÔºåÊ†àÁöÑÂ§ßÂ∞èÊòØÂÖàÂâçÂÆö‰πâÁöÑÂ∏∏Èáè„ÄÇ<code>data</code>¬†ÊòØ‰∏Ä‰∏™Â≠óËäÇÊï∞ÁªÑÔºåÂ≠òÂÇ®Ê†àÁöÑÊï∞ÊçÆ„ÄÇ</li>
<li><code>#[repr(align(4096))]</code>ÔºöËøôÊòØ‰∏ÄÁßç Rust ÁâπÊÄßÔºåÁî®‰∫éÊåáÂÆöÁªìÊûÑ‰ΩìÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑÂØπÈΩêÊñπÂºèÔºåËøôÈáåËÆæÁΩÆ‰∏∫ 4096 Â≠óËäÇÂØπÈΩê„ÄÇËøôÊ†∑ÂÅöÁöÑÁõÆÁöÑÊòØÁ°Æ‰øùÊ†àÂÜÖÂ≠òÁöÑÂØπÈΩêÁ¨¶ÂêàÊìç‰ΩúÁ≥ªÁªüÁöÑË¶ÅÊ±Ç„ÄÇ</li>
<li><code>KERNEL_STACK</code>¬†Âíå¬†<code>USER_STACK</code>ÔºöËøô‰∫õÊòØÂÖ®Â±ÄÈùôÊÄÅÂèòÈáèÔºåÂàÜÂà´‰øùÂ≠òÂÜÖÊ†∏Ê†àÂíåÁî®Êà∑Ê†à„ÄÇÂÆÉ‰ª¨ÊòØ‰∏çÂèØÂèòÁöÑÔºå‰∏îÂè™‰ºöÂàùÂßãÂåñ‰∏ÄÊ¨°„ÄÇ</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">KernelStack</span> {</span><br><span class="line">¬† ¬† <span class="keyword">fn</span> <span class="title function_">get_sp</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> {</span><br><span class="line">¬† ¬† ¬† ¬† <span class="keyword">self</span>.data.<span class="title function_ invoke__">as_ptr</span>() <span class="keyword">as</span> <span class="type">usize</span> + KERNEL_STACK_SIZE</span><br><span class="line">¬† ¬† }</span><br><span class="line">¬† ¬† <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">push_context</span>(&amp;<span class="keyword">self</span>, cx: TrapContext) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">'static</span> <span class="keyword">mut</span> TrapContext {</span><br><span class="line">¬† ¬† ¬† ¬† <span class="keyword">let</span> <span class="variable">cx_ptr</span> = (<span class="keyword">self</span>.<span class="title function_ invoke__">get_sp</span>() - core::mem::size_of::&lt;TrapContext&gt;()) <span class="keyword">as</span> *<span class="keyword">mut</span> TrapContext;</span><br><span class="line">¬† ¬† ¬† ¬† <span class="keyword">unsafe</span> {</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† *cx_ptr = cx;</span><br><span class="line">¬† ¬† ¬† ¬† }</span><br><span class="line">¬† ¬† ¬† ¬† <span class="keyword">unsafe</span> { cx_ptr.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>() }</span><br><span class="line">¬† ¬† }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">UserStack</span> {</span><br><span class="line">¬† ¬† <span class="keyword">fn</span> <span class="title function_">get_sp</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> {</span><br><span class="line">¬† ¬† ¬† ¬† <span class="keyword">self</span>.data.<span class="title function_ invoke__">as_ptr</span>() <span class="keyword">as</span> <span class="type">usize</span> + USER_STACK_SIZE</span><br><span class="line">¬† ¬† }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ul>
<li><code>get_sp()</code>ÔºöËøîÂõûÂΩìÂâçÊ†àÊåáÈíàÔºàStack PointerÔºâ„ÄÇÂè™Ë¶ÅËøîÂõû <code>data</code> Êï∞ÁªÑÁöÑÁªìÂ∞æÂú∞ÂùÄÂç≥ÂèØ„ÄÇÈÄöËøáËé∑ÂèñÊ†àÁöÑ¬†<code>data</code>¬†Êï∞ÁªÑÁöÑÊåáÈíàÂæóÂà∞Ëµ∑ÂßãÂú∞ÂùÄÔºåÂπ∂Âä†‰∏äÊ†àÁöÑÂ§ßÂ∞èÊù•ËÆ°ÁÆóÂΩìÂâçÊ†àÈ°∂ÁöÑ‰ΩçÁΩÆ„ÄÇ</li>
<li><code>push_context()</code>ÔºöÂ∞Ü‰∏Ä‰∏™¬†<code>TrapContext</code>¬†Êé®ÂÖ•Ê†à‰∏≠„ÄÇËøô‰∏™ÂáΩÊï∞Â∞Ü¬†<code>TrapContext</code>¬†ÁªìÊûÑ‰ΩìÊé®ÈÄÅÂà∞Ê†à‰∏≠ÔºåÂπ∂ËøîÂõûÂØπÂÆÉÁöÑÂèØÂèòÂºïÁî®Ôºö<ul>
<li>ËÆ°ÁÆóÊ†àÈ°∂ÁöÑ‰ΩçÁΩÆÔºåÂπ∂ÂáèÂéª¬†<code>TrapContext</code>¬†ÁªìÊûÑ‰ΩìÁöÑÂ§ßÂ∞èÊù•Ëé∑ÂèñÊ≠£Á°ÆÁöÑÂÜÖÂ≠ò‰ΩçÁΩÆ„ÄÇ</li>
<li>Â∞Ü‰º†ÂÖ•ÁöÑ¬†<code>TrapContext</code>¬†Â≠òÂÇ®Âà∞ËØ•‰ΩçÁΩÆ„ÄÇ</li>
<li>‰ΩøÁî®¬†<code>unsafe</code>¬†Â∞ÜÊåáÈíàËΩ¨Êç¢‰∏∫ÂèØÂèòÂºïÁî®Âπ∂ËøîÂõû„ÄÇËøô‰∏™Êìç‰ΩúÊòØÂç±Èô©ÁöÑÔºåÂõ†‰∏∫ÂÆÉÁªïËøá‰∫Ü Rust ÁöÑÊâÄÊúâÊùÉÂíåÂÄüÁî®Ê£ÄÊü•„ÄÇ</li>
</ul>
</li>
</ul>
<ul>
<li><code>TrapContext</code>¬†ÁªìÊûÑ‰ΩìÂ¶Ç‰∏ãÔºåÂåÖÂê´ÈÄöÁî®ÂØÑÂ≠òÂô®„ÄÅ<code>sstatus</code> ÂØÑÂ≠òÂô®Âíå<code>sepc</code> ÂØÑÂ≠òÂô®</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/trap/context.rs</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[repr(C)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">TrapContext</span> {</span><br><span class="line">    <span class="keyword">pub</span> x: [<span class="type">usize</span>; <span class="number">32</span>],</span><br><span class="line">    <span class="keyword">pub</span> sstatus: Sstatus,</span><br><span class="line">    <span class="keyword">pub</span> sepc: <span class="type">usize</span>,</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="TrapÁõ∏ÂÖ≥"><a href="#TrapÁõ∏ÂÖ≥" class="headerlink" title="TrapÁõ∏ÂÖ≥"></a>TrapÁõ∏ÂÖ≥</h3><p>Âú®<code>main.rs</code> ‰∏≠ÔºåÈ¶ñÂÖàË∞ÉÁî®‰∫Ü<code>trap::init()</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/trap/mod.rs</span></span><br><span class="line"></span><br><span class="line">global_asm!(<span class="built_in">include_str!</span>(<span class="string">"trap.S"</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">init</span>() {</span><br><span class="line">    <span class="keyword">extern</span> <span class="string">"C"</span> { <span class="keyword">fn</span> <span class="title function_">__alltraps</span>(); }</span><br><span class="line">    <span class="keyword">unsafe</span> {</span><br><span class="line">        stvec::<span class="title function_ invoke__">write</span>(__alltraps <span class="keyword">as</span> <span class="type">usize</span>, TrapMode::Direct);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol>
<li>ÈÄöËøá¬†<code>global_asm!</code>¬†ÂºïÂÖ•Ê±áÁºñÊñá‰ª∂¬†<code>trap.S</code>ÔºåÂÖ∂‰∏≠ÂåÖÂê´ÂºÇÂ∏∏Â§ÑÁêÜÁõ∏ÂÖ≥ÁöÑÊ±áÁºñ‰ª£Á†Å„ÄÇ</li>
<li>¬†<code>init</code>¬†ÂáΩÊï∞Áî®‰∫éÂàùÂßãÂåñ RISC-V CPU ‰∏≠ÁöÑ¬†<code>stvec</code>¬†ÂØÑÂ≠òÂô®„ÄÇ<code>stvec</code>¬†ÂØÑÂ≠òÂô®ÁöÑ‰ΩúÁî®ÊòØÂ≠òÂÇ®ÂºÇÂ∏∏Â§ÑÁêÜÁ®ãÂ∫èÁöÑÂÖ•Âè£Âú∞ÂùÄ„ÄÇ</li>
<li>Âú®¬†<code>init</code>¬†ÂáΩÊï∞‰∏≠Ôºå‰ΩøÁî®¬†<code>stvec::write</code>¬†ËÆæÁΩÆ¬†<code>stvec</code>¬†ÂØÑÂ≠òÂô®‰∏∫¬†<code>__alltraps</code>¬†ÂáΩÊï∞ÁöÑÂú∞ÂùÄÔºåÂπ∂ÊåáÂÆöÂ§ÑÁêÜÊ®°Âºè‰∏∫¬†<strong>Direct</strong>„ÄÇËøôÊ†∑ÔºåÂú®ÂèëÁîüÂºÇÂ∏∏Êó∂ÔºåCPU ‰ºöÁõ¥Êé•Ë∑≥ËΩ¨Âà∞¬†<code>__alltraps</code>¬†Êù•Â§ÑÁêÜÊâÄÊúâÁöÑÂºÇÂ∏∏„ÄÇ</li>
</ol>
<ul>
<li>ÁõÆÁöÑÊòØÈÖçÁΩÆ RISC-V Á≥ªÁªüÁöÑÂºÇÂ∏∏ÂêëÈáèË°®Ôºå‰ª•‰æøÊ≠£Á°ÆÂú∞Â§ÑÁêÜÁ°¨‰ª∂ÊàñËΩØ‰ª∂ÂºÇÂ∏∏„ÄÇ</li>
</ul>
<p><code>trap.S</code> ‰∏≠‰∏ªË¶ÅÂåÖÂê´‰∏§ÈÉ®ÂàÜÔºå<code>__alltraps</code> Âíå <code>__restore</code> Ôºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">.altmacro</span><br><span class="line">.macro SAVE_GP n</span><br><span class="line">¬† ¬† sd x\n, \n*8(sp)</span><br><span class="line">.endm</span><br><span class="line">.macro LOAD_GP n</span><br><span class="line">¬† ¬† ld x\n, \n*8(sp)</span><br><span class="line">.endm</span><br><span class="line">¬† ¬† .section .text</span><br><span class="line">¬† ¬† .globl __alltraps</span><br><span class="line">¬† ¬† .globl __restore</span><br><span class="line">¬† ¬† .align 2</span><br><span class="line">__alltraps:</span><br><span class="line">¬† ¬† csrrw sp, sscratch, sp</span><br><span class="line">¬† ¬† # now sp-&gt;kernel stack, sscratch-&gt;user stack</span><br><span class="line">¬† ¬† # allocate a TrapContext on kernel stack</span><br><span class="line">¬† ¬† addi sp, sp, -34*8</span><br><span class="line">¬† ¬† # save general-purpose registers</span><br><span class="line">¬† ¬† sd x1, 1*8(sp)</span><br><span class="line">¬† ¬† # skip sp(x2), we will save it later</span><br><span class="line">¬† ¬† sd x3, 3*8(sp)</span><br><span class="line">¬† ¬† # skip tp(x4), application does not use it</span><br><span class="line">¬† ¬† # save x5~x31</span><br><span class="line">¬† ¬† .set n, 5</span><br><span class="line">¬† ¬† .rept 27</span><br><span class="line">¬† ¬† ¬† ¬† SAVE_GP %n</span><br><span class="line">¬† ¬† ¬† ¬† .set n, n+1</span><br><span class="line">¬† ¬† .endr</span><br><span class="line">¬† ¬† # we can use t0/t1/t2 freely, because they were saved on kernel stack</span><br><span class="line">¬† ¬† csrr t0, sstatus</span><br><span class="line">¬† ¬† csrr t1, sepc</span><br><span class="line">¬† ¬† sd t0, 32*8(sp)</span><br><span class="line">¬† ¬† sd t1, 33*8(sp)</span><br><span class="line">¬† ¬† # read user stack from sscratch and save it on the kernel stack</span><br><span class="line">¬† ¬† csrr t2, sscratch</span><br><span class="line">¬† ¬† sd t2, 2*8(sp)</span><br><span class="line">¬† ¬† # set input argument of trap_handler(cx: &amp;mut TrapContext)</span><br><span class="line">¬† ¬† mv a0, sp</span><br><span class="line">¬† ¬† call trap_handler</span><br></pre></td></tr></table></figure>
<ul>
<li>ËøôÊÆµÊ±áÁºñ‰ª£Á†ÅÁî®Êù•Â§ÑÁêÜ RISC-V Á≥ªÁªü‰∏≠ÁöÑÂºÇÂ∏∏Â§ÑÁêÜÁöÑÊ†∏ÂøÉÈÉ®ÂàÜÔºåÊ∂âÂèäÂà∞‰øùÂ≠ò‰∏ä‰∏ãÊñáÔºàÂåÖÊã¨ÈÄöÁî®ÂØÑÂ≠òÂô®ÂíåÂ†ÜÊ†à‰ø°ÊÅØÔºâÔºåË∞ÉÁî®‰∏Ä‰∏™Èô∑Èò±Â§ÑÁêÜÁ®ãÂ∫è <code>trap_handler</code> Êù•Â§ÑÁêÜÂèëÁîüÁöÑÂºÇÂ∏∏Êàñ‰∏≠Êñ≠„ÄÇ</li>
</ul>
<ul>
<li><strong><code>SAVE_GP n</code></strong>: Ëøô‰∏™ÂÆèÁî®‰∫éÂ∞ÜÈÄöÁî®ÂØÑÂ≠òÂô®¬†<code>x[n]</code>¬†ÁöÑÂÄº‰øùÂ≠òÂà∞Â†ÜÊ†à‰∏ä„ÄÇÂÖ∑‰ΩìÂú∞ÔºåÂÆÉ‰ºöÂ∞ÜÂØÑÂ≠òÂô®¬†<code>x[n]</code>¬†ÁöÑÂÄº‰øùÂ≠òÂà∞¬†<code>sp</code>ÔºàÂ†ÜÊ†àÊåáÈíàÔºâÊâÄÊåáÂêëÁöÑ‰ΩçÁΩÆÔºåÂÅèÁßªÈáèÊòØ¬†<code>n*8</code>„ÄÇ</li>
<li><strong><code>LOAD_GP n</code></strong>: Ëøô‰∏™ÂÆèÁî®‰∫é‰ªéÂ†ÜÊ†àÂä†ËΩΩÈÄöÁî®ÂØÑÂ≠òÂô®¬†<code>x[n]</code>¬†ÁöÑÂÄº„ÄÇÂÆÉ‰ºö‰ªé¬†<code>sp</code>¬†ÊåáÂêëÁöÑ‰ΩçÁΩÆÂä†ËΩΩÊï∞ÊçÆÔºåÂπ∂ÊÅ¢Â§çÂà∞¬†<code>x[n]</code>„ÄÇ</li>
<li><strong><code>.align 2</code></strong>: ÂØπÈΩêÔºå‰øùËØÅ¬†<code>__alltraps</code>¬†ÁöÑËµ∑ÂßãÂú∞ÂùÄÊòØ 4 Â≠óËäÇÂØπÈΩê„ÄÇ</li>
<li><strong><code>csrrw sp, sscratch, sp</code></strong>: ËøôÊù°Êåá‰ª§Â∞Ü¬†<code>sp</code>¬†ÁöÑÂÄºÂ≠òÂÇ®Âà∞¬†<code>sscratch</code>¬†ÂØÑÂ≠òÂô®ÔºåÂπ∂Â∞Ü¬†<code>sscratch</code>¬†ÁöÑÂÄºÂä†ËΩΩÂà∞¬†<code>sp</code>„ÄÇ<code>sp</code>¬†ÂØÑÂ≠òÂô®Áé∞Âú®ÊåáÂêëÂÜÖÊ†∏Ê†àÔºå<code>sscratch</code>¬†ÂØÑÂ≠òÂô®‰øùÂ≠ò‰∫ÜÁî®Êà∑Ê†àÁöÑÂú∞ÂùÄ„ÄÇ</li>
<li><strong><code>.set n, 5</code></strong>: ËÆæÁΩÆ‰∏Ä‰∏™ÂèòÈáè¬†<code>n</code>¬†‰∏∫ 5ÔºåËøôÊòØ‰ªé¬†<code>x5</code>¬†ÂØÑÂ≠òÂô®ÂºÄÂßã‰øùÂ≠òÁöÑËµ∑ÂßãÂØÑÂ≠òÂô®Ôºå<strong><code>.rept 27</code></strong>:¬†<code>rept</code>¬†ÊòØ‰∏Ä‰∏™Âæ™ÁéØÊåá‰ª§ÔºåË°®Á§∫ÈáçÂ§ç 27 Ê¨°„ÄÇÊØèÊ¨°Ëø≠‰ª£‰ºöË∞ÉÁî®¬†<code>SAVE_GP %n</code>¬†Êù•‰øùÂ≠ò‰∏Ä‰∏™ÂØÑÂ≠òÂô®ÁöÑÂÄº„ÄÇ<code>SAVE_GP</code>¬†ÂÆè‰ºöÂ∞ÜÊØè‰∏™ÂØÑÂ≠òÂô®¬†<code>x5</code>¬†Âà∞¬†<code>x31</code>¬†ÁöÑÂÄº‰øùÂ≠òÂà∞Â†ÜÊ†à‰∏ä„ÄÇÂâçÈù¢ÁöÑ <code>x1</code> Âíå <code>x3</code> ÂØÑÂ≠òÂô®Â∑≤ÁªèÊâãÂä®‰øùÂ≠òÔºåË∑≥Ëøá <code>x0</code> Âíå <code>tp(x4)</code> ÂØÑÂ≠òÂô®„ÄÇ</li>
<li><strong><code>csrr t0, sstatus</code></strong>: ËØªÂèñ¬†<code>sstatus</code>¬†ÂØÑÂ≠òÂô®ÁöÑÂÄºÔºà‰øùÂ≠òÂΩìÂâçÁä∂ÊÄÅ‰ø°ÊÅØÔºâÂπ∂Â≠òÂÇ®Âà∞¬†<code>t0</code>¬†ÂØÑÂ≠òÂô®„ÄÇ</li>
<li><strong><code>csrr t1, sepc</code></strong>: ËØªÂèñ¬†<code>sepc</code>¬†ÂØÑÂ≠òÂô®ÁöÑÂÄºÔºà‰øùÂ≠òÁ®ãÂ∫èËÆ°Êï∞Âô®ÔºâÂπ∂Â≠òÂÇ®Âà∞¬†<code>t1</code>¬†ÂØÑÂ≠òÂô®„ÄÇ</li>
<li><strong><code>csrr t2, sscratch</code></strong>: ËØªÂèñ¬†<code>sscratch</code>¬†ÂØÑÂ≠òÂô®ÁöÑÂÄºÔºà‰øùÂ≠òÂéüÁî®Êà∑Ê†àÊåáÈíàÔºâÂπ∂Â≠òÂÇ®Âà∞¬†<code>t2</code>¬†ÂØÑÂ≠òÂô®„ÄÇ</li>
</ul>
<p><code>__restore</code> ‰ΩúÁî®ÊòØÂÆåÊàêÂºÇÂ∏∏Â§ÑÁêÜÂêéÔºåÊÅ¢Â§çÁî®Êà∑ÊÄÅÁöÑÁä∂ÊÄÅÔºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">__restore:</span><br><span class="line">¬† ¬† # case1: start running app by __restore</span><br><span class="line">¬† ¬† # case2: back to U after handling trap</span><br><span class="line">¬† ¬† mv sp, a0</span><br><span class="line">¬† ¬† # now sp-&gt;kernel stack(after allocated), sscratch-&gt;user stack</span><br><span class="line">¬† ¬† # restore sstatus/sepc</span><br><span class="line">¬† ¬† ld t0, 32*8(sp)</span><br><span class="line">¬† ¬† ld t1, 33*8(sp)</span><br><span class="line">¬† ¬† ld t2, 2*8(sp)</span><br><span class="line">¬† ¬† csrw sstatus, t0</span><br><span class="line">¬† ¬† csrw sepc, t1</span><br><span class="line">¬† ¬† csrw sscratch, t2</span><br><span class="line">¬† ¬† # restore general-purpuse registers except sp/tp</span><br><span class="line">¬† ¬† ld x1, 1*8(sp)</span><br><span class="line">¬† ¬† ld x3, 3*8(sp)</span><br><span class="line">¬† ¬† .set n, 5</span><br><span class="line">¬† ¬† .rept 27</span><br><span class="line">¬† ¬† ¬† ¬† LOAD_GP %n</span><br><span class="line">¬† ¬† ¬† ¬† .set n, n+1</span><br><span class="line">¬† ¬† .endr</span><br><span class="line">¬† ¬† # release TrapContext on kernel stack</span><br><span class="line">¬† ¬† addi sp, sp, 34*8</span><br><span class="line">¬† ¬† # now sp-&gt;kernel stack, sscratch-&gt;user stack</span><br><span class="line">¬† ¬† csrrw sp, sscratch, sp</span><br><span class="line">¬† ¬† sret</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>mv sp, a0</code></strong>ÔºöÂ∞Ü¬†<code>a0</code>ÔºàÁî±¬†<code>trap_handler</code>¬†ÂáΩÊï∞‰º†ÈÄíÁöÑÂèÇÊï∞Ôºâ‰∏≠ÁöÑÂÄºËµãÁªô¬†<code>sp</code>ÔºàÂ†ÜÊ†àÊåáÈíàÔºâ„ÄÇ<code>a0</code>¬†‰πãÂâç‰øùÂ≠ò‰∫ÜÂºÇÂ∏∏Â§ÑÁêÜËøáÁ®ã‰∏≠ÂàÜÈÖçÁöÑÂÜÖÊ†∏Ê†àÁöÑËµ∑ÂßãÂú∞ÂùÄ„ÄÇÁé∞Âú®Ôºå<code>sp</code>¬†Â∞ÜÊåáÂêëÂÜÖÊ†∏Ê†àÁöÑ‰ΩçÁΩÆÔºåÂêéÁª≠ÁöÑÊìç‰ΩúÂ∞ÜÂü∫‰∫éËøô‰∏™Â†ÜÊ†àÊù•ÊÅ¢Â§ç‰∏ä‰∏ãÊñá„ÄÇ</li>
</ul>
<ul>
<li>ÊÅ¢Â§ç¬†<code>sstatus</code>„ÄÅ<code>sepc</code>¬†Âíå¬†<code>sscratch</code>Ôºå‰ªéÂ†ÜÊ†à‰∏äÂä†ËΩΩ‰πãÂâç‰øùÂ≠òÁöÑÂÄºÂà∞ÈÄöÁî®ÂØÑÂ≠òÂô®‰∏≠ÔºåÂÜçÊÅ¢Â§çÂà∞ÂØπÂ∫îÁöÑCSRÂØÑÂ≠òÂô®„ÄÇ</li>
<li>ÊÅ¢Â§çÈÄöÁî®ÂØÑÂ≠òÂô®Ôºå‰∏é‰øùÂ≠òÊó∂Á±ª‰ººÔºå‰ΩøÁî®ÂÆèÔºåË∑≥Ëøá <code>x0</code> Âíå <code>tp(x4)</code> ÂØÑÂ≠òÂô®„ÄÇ</li>
<li><strong><code>csrrw sp, sscratch, sp</code></strong>: Â∞ÜÂ†ÜÊ†àÊåáÈíà¬†<code>sp</code>¬†ÁöÑÂÄº‰∫§Êç¢Âà∞¬†<code>sscratch</code>¬†ÂØÑÂ≠òÂô®‰∏≠ÔºåÂéüÂÖà‰øùÂ≠òÁöÑÁî®Êà∑Ê†àÊåáÈíàÊÅ¢Â§çÂà∞¬†<code>sp</code>¬†‰∏≠„ÄÇÊ≠§Êó∂Ôºå<code>sp</code>¬†‰ºöÊåáÂêëÁî®Êà∑Á©∫Èó¥Ê†àÔºåËøôÊ†∑Êé•‰∏ãÊù•ÂèØ‰ª•ÁªßÁª≠ÊâßË°åÁî®Êà∑Á®ãÂ∫è„ÄÇÁÑ∂ÂêéËøîÂõûÁî®Êà∑ÊÄÅ„ÄÇ</li>
</ul>
<p><code>trap_handler</code> ÂáΩÊï∞Áî®‰∫éÂàÜÂèëÂíåÂ§ÑÁêÜtrapÔºö</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[no_mangle]</span></span><br><span class="line"><span class="comment">/// handle an interrupt, exception, or system call from user space</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">trap_handler</span>(cx: &amp;<span class="keyword">mut</span> TrapContext) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> TrapContext {</span><br><span class="line">¬† ¬† <span class="keyword">let</span> <span class="variable">scause</span> = scause::<span class="title function_ invoke__">read</span>(); <span class="comment">// get trap cause</span></span><br><span class="line">¬† ¬† <span class="keyword">let</span> <span class="variable">stval</span> = stval::<span class="title function_ invoke__">read</span>(); <span class="comment">// get extra value</span></span><br><span class="line">¬† ¬† <span class="keyword">match</span> scause.<span class="title function_ invoke__">cause</span>() {</span><br><span class="line">¬† ¬† ¬† ¬† Trap::<span class="title function_ invoke__">Exception</span>(Exception::UserEnvCall) =&gt; {</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† cx.sepc += <span class="number">4</span>;</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† cx.x[<span class="number">10</span>] = <span class="title function_ invoke__">syscall</span>(cx.x[<span class="number">17</span>], [cx.x[<span class="number">10</span>], cx.x[<span class="number">11</span>], cx.x[<span class="number">12</span>]]) <span class="keyword">as</span> <span class="type">usize</span>;</span><br><span class="line">¬† ¬† ¬† ¬† }</span><br><span class="line">¬† ¬† ¬† ¬† Trap::<span class="title function_ invoke__">Exception</span>(Exception::StoreFault) | Trap::<span class="title function_ invoke__">Exception</span>(Exception::StorePageFault) =&gt; {</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† <span class="built_in">println!</span>(<span class="string">"[kernel] PageFault in application, kernel killed it."</span>);</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† <span class="title function_ invoke__">run_next_app</span>();</span><br><span class="line">¬† ¬† ¬† ¬† }</span><br><span class="line">¬† ¬† ¬† ¬† Trap::<span class="title function_ invoke__">Exception</span>(Exception::IllegalInstruction) =&gt; {</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† <span class="built_in">println!</span>(<span class="string">"[kernel] IllegalInstruction in application, kernel killed it."</span>);</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† <span class="title function_ invoke__">run_next_app</span>();</span><br><span class="line">¬† ¬† ¬† ¬† }</span><br><span class="line">¬† ¬† ¬† ¬† _ =&gt; {</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† <span class="built_in">panic!</span>(</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <span class="string">"Unsupported trap {:?}, stval = {:#x}!"</span>,</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† scause.<span class="title function_ invoke__">cause</span>(),</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† stval</span><br><span class="line">¬† ¬† ¬† ¬† ¬† ¬† );</span><br><span class="line">¬† ¬† ¬† ¬† }</span><br><span class="line">¬† ¬† }</span><br><span class="line">¬† ¬† cx</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>‰ΩøÁî® <code>match</code> ËØ≠Âè•Ê†πÊçÆ <code>scause</code> ‰∏≠ÁöÑÂÖ∑‰ΩìËß¶ÂèëÂéüÂõ†Ôºà<code>scause.cause()</code>ÔºâÊù•ÈÄâÊã©Â¶Ç‰ΩïÂ§ÑÁêÜ‰∏çÂêåÁ±ªÂûãÁöÑÂºÇÂ∏∏Êàñ‰∏≠Êñ≠„ÄÇ</p>
<ul>
<li>ÂΩìËß¶ÂèëÂéüÂõ†ÊòØÁî®Êà∑ÁéØÂ¢ÉË∞ÉÁî®Ôºà<code>UserEnvCall</code>ÔºâÊó∂ÔºåË°®Á§∫ËøôÊòØ‰∏Ä‰∏™Á≥ªÁªüË∞ÉÁî®ÁöÑËØ∑Ê±ÇÔºàÈÄöÂ∏∏ÊòØÁî®Êà∑Á®ãÂ∫èËØ∑Ê±ÇÂÜÖÊ†∏Êèê‰æõÊüêÁßçÊúçÂä°Ôºâ„ÄÇ<code>sepc</code>¬†ÂØÑÂ≠òÂô®‰øùÂ≠ò‰∫ÜÂèëÁîüÂºÇÂ∏∏Êó∂ÁöÑPC„ÄÇÁ≥ªÁªüË∞ÉÁî®‰ºö‰øÆÊîπ¬†<code>sepc</code>¬†‰ΩøÂæóÁ®ãÂ∫èË∑≥Âà∞ÂÜÖÊ†∏ÊÄÅ‰ª£Á†Å„ÄÇÊ≠§Êó∂Ôºå<code>sepc</code>¬†Âä†‰∏ä 4 ÊòØ‰∏∫‰∫ÜË∑≥ËøáÁ≥ªÁªüË∞ÉÁî®Êåá‰ª§Ôºà‰æãÂ¶Ç¬†<code>ecall</code>¬†Êåá‰ª§Ôºâ„ÄÇË∞ÉÁî®Á≥ªÁªüË∞ÉÁî®Â§ÑÁêÜÂáΩÊï∞„ÄÇËøôÈáåÁöÑ <code>syscall</code>¬†ÂáΩÊï∞ÊòØÂÜÖÊ†∏‰∏≠ÂÆûÁé∞ÁöÑÁ≥ªÁªüË∞ÉÁî®ÂàÜÂèëÂáΩÊï∞ÔºåÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØÁ≥ªÁªüË∞ÉÁî®Âè∑ÔºàÂ≠òÂÇ®Âú®¬†<code>x[17]</code>ÔºâÔºåÂêéÈù¢ÊòØÁ≥ªÁªüË∞ÉÁî®ÁöÑÂèÇÊï∞ÔºàÂ≠òÂÇ®Âú®¬†<code>x[10]</code>,¬†<code>x[11]</code>, Âíå¬†<code>x[12]</code>Ôºâ„ÄÇ</li>
<li>ÂèëÁîüËÆøÂ≠òÊïÖÈöúÊàñÈ°µÈù¢ÈîôËØØÊó∂ÔºåÊâìÂç∞‰∏ÄÊù°ÈîôËØØ‰ø°ÊÅØÔºåËØ¥ÊòéÂèëÁîü‰∫ÜÂÜÖÂ≠òÊïÖÈöú„ÄÇÂÜÖÊ†∏ÂÜ≥ÂÆöÊùÄÊ≠ªÂΩìÂâçÂ∫îÁî®Á®ãÂ∫èÂπ∂ËøêË°å‰∏ã‰∏Ä‰∏™Â∫îÁî®Á®ãÂ∫è„ÄÇ</li>
<li>ÊâßË°å‰∫Ü‰∏Ä‰∏™Êó†ÊïàÁöÑÊåá‰ª§Êó∂Ôºå‰∏é‰∏ä‰∏ÄÁßçÊÉÖÂÜµ‰∏ÄÊ†∑„ÄÇ</li>
<li>Â¶ÇÊûú‰∏çÊòØ‰∏äËø∞Âá†ÁßçÊÉÖÂÜµÔºåÂÜÖÊ†∏‰ºöËß¶Âèë‰∏Ä‰∏™ panicÔºåËæìÂá∫ÂºÇÂ∏∏Á±ªÂûãÂíåÁõ∏ÂÖ≥ÁöÑÈ¢ùÂ§ñ‰ø°ÊÅØÔºà<code>stval</code>Ôºâ„ÄÇ</li>
</ul>
<p>ÂÜÖÊ†∏‰∏≠ÁöÑÁ≥ªÁªüË∞ÉÁî®ÈÄöËøá¬†<code>syscall</code>¬†ÂáΩÊï∞ÔºåÊ†πÊçÆ syscall ID ÂàÜÂèëÂà∞ÂÖ∑‰ΩìÁöÑÂ§ÑÁêÜÂáΩÊï∞Ôºå‰∏éÁî®Êà∑ÊÄÅ‰∏≠ÂØπÁî®Êà∑ÊÄÅÁöÑ <code>syscall</code> ÂáΩÊï∞ÁöÑÂ∞ÅË£ÖÁ±ª‰ºº„ÄÇ</p>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2025-02-13</span>
            
                <span>ËØ•ÁØáÊñáÁ´†Ë¢´ Derfflinger</span>
            
            
                <span>Êâì‰∏äÊ†áÁ≠æ:
                    
                    
                        <a href='/tags/OS/'>
                            OS
                        </a>
                    
                        <a href='/tags/System/'>
                            System
                        </a>
                    
                        <a href='/tags/RISC-V/'>
                            RISC-V
                        </a>
                    
                        <a href='/tags/Rust/'>
                            Rust
                        </a>
                    
                </span>
             
             
                <span>ÂΩí‰∏∫ÂàÜÁ±ª:
                    
                    
                        <a href='/categories/rCore/'>
                            rCore
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>‰∏ä‰∏ÄÁØáÔºö<a href='/2025/03/25/ch3%20%E5%A4%9A%E9%81%93%E7%A8%8B%E5%BA%8F%E4%B8%8E%E5%88%86%E6%97%B6%E5%A4%9A%E4%BB%BB%E5%8A%A1/'>ch3 Â§öÈÅìÁ®ãÂ∫è‰∏éÂàÜÊó∂Â§ö‰ªªÂä°</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">‰∏ã‰∏ÄÁØáÔºö<a href="/2025/01/27/ch1%20libOS/">ch1 libOS</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
       
    
</div>



<!--ËøôÊòØÊåá‰∏ÄÊù°Á∫øÂæÄ‰∏ãÁöÑÂÜÖÂÆπ-->
<div class="footer-last">
    
            <span></span>
            
                <span class="footer-last-span-right"><i>Êú¨Á´ôÁî±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>È©±Âä®ÔΩú‰ΩøÁî®<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>‰∏ªÈ¢ò</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ÁõÆÂΩï-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--ÂõûÂà∞È°∂ÈÉ®ÊåâÈíÆ-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // ÂêØÁî®Êèí‰ª∂
            thumbnail: true,          // ÊòæÁ§∫Áº©Áï•Âõæ
            zoom: true,               // ÂêØÁî®Áº©ÊîæÂäü
            rotate: true,             // ÂêØÁî®ÊóãËΩ¨ÂäüËÉΩËÉΩ
            autoplay: true,        // ÂêØÁî®Ëá™Âä®Êí≠ÊîæÂäüËÉΩ
            fullScreen: true,      // ÂêØÁî®ÂÖ®Â±èÂäüËÉΩ
            pager: false, //È°µÁ†Å,
            zoomFromOrigin: true,   // ‰ªéÂéüÂßã‰ΩçÁΩÆÁº©Êîæ
            actualSize: true,       // ÂêØÁî®Êü•ÁúãÂÆûÈôÖÂ§ßÂ∞èÁöÑÂäüËÉΩ
            enableZoomAfter: 300,    // Âª∂ËøüÁº©ÊîæÔºåÁ°Æ‰øùÂõæÁâáÂä†ËΩΩÂÆåÊàêÂêéÂèØÁº©Êîæ
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ‰øÆÂ§çÈÄâÊã©Âô®
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- ÂõûÂà∞È°∂ÈÉ®ÁöÑÊåâÈíÆ-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- ËøîÂõûÁöÑÊåâÈíÆ-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>